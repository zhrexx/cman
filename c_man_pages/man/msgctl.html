<!-- Creator     : groff version 1.23.0 -->
<!-- CreationDate: Sat Apr  5 19:40:50 2025 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">

<html>
<head>
<meta content="groff -Thtml, see www.gnu.org" name="generator"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="text/css" name="Content-Style"/>
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>msgctl</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><style>
            :root {
                --primary-color: #3498db;
                --background-color: #f9f9f9;
                --text-color: #333;
                --code-bg: #f0f0f0;
                --header-color: #2c3e50;
                --link-color: #2980b9;
            }
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                line-height: 1.6;
                color: var(--text-color);
                background-color: var(--background-color);
                max-width: 900px;
                margin: 0 auto;
                padding: 2rem;
            }
            h1, h2, h3, h4 {
                color: var(--header-color);
            }
            h1 {
                border-bottom: 2px solid var(--primary-color);
                padding-bottom: 0.5rem;
            }
            pre {
                background-color: var(--code-bg);
                padding: 1rem;
                border-radius: 4px;
                overflow-x: auto;
            }
            a {
                color: var(--link-color);
                text-decoration: none;
            }
            a:hover {
                text-decoration: underline;
            }
            .man-navigation {
                background-color: #fff;
                border-bottom: 1px solid #ddd;
                padding: 0.5rem 0;
                position: sticky;
                top: 0;
                z-index: 100;
            }
            .section {
                margin-top: 2rem;
            }
            @media (prefers-color-scheme: dark) {
                :root {
                    --primary-color: #3498db;
                    --background-color: #222;
                    --text-color: #f0f0f0;
                    --code-bg: #333;
                    --header-color: #3498db;
                    --link-color: #5dade2;
                }
            }
            .back-to-index {
                display: inline-block;
                margin: 1rem 0;
                padding: 0.5rem 1rem;
                background-color: var(--primary-color);
                color: white;
                border-radius: 4px;
                text-decoration: none;
            }
            .back-to-index:hover {
                background-color: var(--link-color);
                text-decoration: none;
            }
        </style></head>
<body><div><a class="back-to-index" href="../index.html">← Back to Index</a></div>
<h1 align="center">msgctl</h1>
<a href="#NAME">NAME</a><br/>
<a href="#LIBRARY">LIBRARY</a><br/>
<a href="#SYNOPSIS">SYNOPSIS</a><br/>
<a href="#DESCRIPTION">DESCRIPTION</a><br/>
<a href="#RETURN VALUE">RETURN VALUE</a><br/>
<a href="#ERRORS">ERRORS</a><br/>
<a href="#STANDARDS">STANDARDS</a><br/>
<a href="#HISTORY">HISTORY</a><br/>
<a href="#NOTES">NOTES</a><br/>
<a href="#SEE ALSO">SEE ALSO</a><br/>
<hr/>
<h2>NAME
<a name="NAME"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">msgctl −
System V message control operations</p>
<h2>LIBRARY
<a name="LIBRARY"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">Standard C
library (<i>libc</i>, <i>−lc</i>)</p>
<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>#include
&lt;sys/msg.h&gt;</b></p>
<p style="margin-left:9%; margin-top: 1em"><b>int
msgctl(int</b> <i>msqid</i><b>, int</b> <i>op</i><b>, struct
msqid_ds *</b><i>buf</i><b>);</b></p>
<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>msgctl</b>()
performs the control operation specified by <i>op</i> on the
System V message queue with identifier
<i>msqid</i>.</p>
<p style="margin-left:9%; margin-top: 1em">The
<i>msqid_ds</i> data structure is defined in
<i>&lt;sys/msg.h&gt;</i> as follows:</p>
<p style="margin-left:14%; margin-top: 1em">struct msqid_ds
{ <br/>
struct ipc_perm msg_perm; /* Ownership and permissions */
<br/>
time_t msg_stime; /* Time of last msgsnd(2) */ <br/>
time_t msg_rtime; /* Time of last msgrcv(2) */ <br/>
time_t msg_ctime; /* Time of creation or last <br/>
modification by msgctl() */ <br/>
unsigned long msg_cbytes; /* # of bytes in queue */ <br/>
msgqnum_t msg_qnum; /* # number of messages in queue */ <br/>
msglen_t msg_qbytes; /* Maximum # of bytes in queue */ <br/>
pid_t msg_lspid; /* PID of last msgsnd(2) */ <br/>
pid_t msg_lrpid; /* PID of last msgrcv(2) */ <br/>
};</p>
<p style="margin-left:9%; margin-top: 1em">The fields of
the <i>msqid_ds</i> structure are as follows:</p>
<table border="0" cellpadding="0" cellspacing="0" frame="void" rules="none" width="100%">
<tr align="left" valign="top">
<td width="9%"></td>
<td width="13%">
<p><i>msg_perm</i></p></td>
<td width="1%"></td>
<td width="77%">
<p>This is an <i>ipc_perm</i> structure (see below) that
specifies the access permissions on the message queue.</p></td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="13%">
<p><i>msg_stime</i></p></td>
<td width="1%"></td>
<td width="77%">
<p>Time of the last <b>msgsnd</b>(2) system call.</p></td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="13%">
<p><i>msg_rtime</i></p></td>
<td width="1%"></td>
<td width="77%">
<p>Time of the last <b>msgrcv</b>(2) system call.</p></td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="13%">
<p><i>msg_ctime</i></p></td>
<td width="1%"></td>
<td width="77%">
<p>Time of creation of queue or time of last
<b>msgctl</b>() <b>IPC_SET</b> operation.</p></td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="13%">
<p><i>msg_cbytes</i></p></td>
<td width="1%"></td>
<td width="77%">
<p>Number of bytes in all messages currently on the message
queue. This is a nonstandard Linux extension that is not
specified in POSIX.</p></td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="13%">
<p><i>msg_qnum</i></p></td>
<td width="1%"></td>
<td width="77%">
<p>Number of messages currently on the message queue.</p></td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="13%">
<p><i>msg_qbytes</i></p></td>
<td width="1%"></td>
<td width="77%">
<p>Maximum number of bytes of message text allowed on the
message queue.</p></td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="13%">
<p><i>msg_lspid</i></p></td>
<td width="1%"></td>
<td width="77%">
<p>ID of the process that performed the last
<b>msgsnd</b>(2) system call.</p></td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="13%">
<p><i>msg_lrpid</i></p></td>
<td width="1%"></td>
<td width="77%">
<p>ID of the process that performed the last
<b>msgrcv</b>(2) system call.</p></td></tr>
</table>
<p style="margin-left:9%; margin-top: 1em">The
<i>ipc_perm</i> structure is defined as follows (the
highlighted fields are settable using <b>IPC_SET</b>):</p>
<p style="margin-left:14%; margin-top: 1em">struct ipc_perm
{ <br/>
key_t __key; /* Key supplied to msgget(2) */ <br/>
uid_t <b>uid</b>; /* Effective UID of owner */ <br/>
gid_t <b>gid</b>; /* Effective GID of owner */ <br/>
uid_t cuid; /* Effective UID of creator */ <br/>
gid_t cgid; /* Effective GID of creator */ <br/>
unsigned short <b>mode</b>; /* Permissions */ <br/>
unsigned short __seq; /* Sequence number */ <br/>
};</p>
<p style="margin-left:9%; margin-top: 1em">The least
significant 9 bits of the <i>mode</i> field of the
<i>ipc_perm</i> structure define the access permissions for
the message queue. The permission bits are as follows:</p>
<p style="margin-left:9%; margin-top: 1em">Bits 0100, 0010,
and 0001 (the execute bits) are unused by the system.</p>
<p style="margin-left:9%; margin-top: 1em">Valid values for
<i>op</i> are: <b><br/>
IPC_STAT</b></p>
<p style="margin-left:18%;">Copy information from the
kernel data structure associated with <i>msqid</i> into the
<i>msqid_ds</i> structure pointed to by <i>buf</i>. The
caller must have read permission on the message queue.</p>
<p style="margin-left:9%;"><b>IPC_SET</b></p>
<p style="margin-left:18%;">Write the values of some
members of the <i>msqid_ds</i> structure pointed to by
<i>buf</i> to the kernel data structure associated with this
message queue, updating also its <i>msg_ctime</i>
member.</p>
<p style="margin-left:18%; margin-top: 1em">The following
members of the structure are updated: <i>msg_qbytes</i>,
<i>msg_perm.uid</i>, <i>msg_perm.gid</i>, and (the least
significant 9 bits of) <i>msg_perm.mode</i>.</p>
<p style="margin-left:18%; margin-top: 1em">The effective
UID of the calling process must match the owner
(<i>msg_perm.uid</i>) or creator (<i>msg_perm.cuid</i>) of
the message queue, or the caller must be privileged.
Appropriate privilege (Linux: the <b>CAP_SYS_RESOURCE</b>
capability) is required to raise the <i>msg_qbytes</i> value
beyond the system parameter <b>MSGMNB</b>.</p>
<p style="margin-left:9%;"><b>IPC_RMID</b></p>
<p style="margin-left:18%;">Immediately remove the message
queue, awakening all waiting reader and writer processes
(with an error return and <i>errno</i> set to <b>EIDRM</b>).
The calling process must have appropriate privileges or its
effective user ID must be either that of the creator or
owner of the message queue. The third argument to
<b>msgctl</b>() is ignored in this case.</p>
<p style="margin-left:9%;"><b>IPC_INFO</b>
(Linux-specific)</p>
<p style="margin-left:18%;">Return information about
system-wide message queue limits and parameters in the
structure pointed to by <i>buf</i>. This structure is of
type <i>msginfo</i> (thus, a cast is required), defined in
<i>&lt;sys/msg.h&gt;</i> if the <b>_GNU_SOURCE</b> feature
test macro is defined:</p>
<p style="margin-left:23%; margin-top: 1em">struct msginfo
{ <br/>
int msgpool; /* Size in kibibytes of buffer pool <br/>
used to hold message data; <br/>
unused within kernel */ <br/>
int msgmap; /* Maximum number of entries in message <br/>
map; unused within kernel */ <br/>
int msgmax; /* Maximum number of bytes that can be <br/>
written in a single message */ <br/>
int msgmnb; /* Maximum number of bytes that can be <br/>
written to queue; used to initialize <br/>
msg_qbytes during queue creation <br/>
(msgget(2)) */ <br/>
int msgmni; /* Maximum number of message queues */ <br/>
int msgssz; /* Message segment size; <br/>
unused within kernel */ <br/>
int msgtql; /* Maximum number of messages on all queues <br/>
in system; unused within kernel */ <br/>
unsigned short msgseg; <br/>
/* Maximum number of segments; <br/>
unused within kernel */ <br/>
};</p>
<p style="margin-left:18%; margin-top: 1em">The
<i>msgmni</i>, <i>msgmax</i>, and <i>msgmnb</i> settings can
be changed via <i>/proc</i> files of the same name; see
<b>proc</b>(5) for details.</p>
<p style="margin-left:9%;"><b>MSG_INFO</b>
(Linux-specific)</p>
<p style="margin-left:18%;">Return a <i>msginfo</i>
structure containing the same information as for
<b>IPC_INFO</b>, except that the following fields are
returned with information about system resources consumed by
message queues: the <i>msgpool</i> field returns the number
of message queues that currently exist on the system; the
<i>msgmap</i> field returns the total number of messages in
all queues on the system; and the <i>msgtql</i> field
returns the total number of bytes in all messages in all
queues on the system.</p>
<p style="margin-left:9%;"><b>MSG_STAT</b>
(Linux-specific)</p>
<p style="margin-left:18%;">Return a <i>msqid_ds</i>
structure as for <b>IPC_STAT</b>. However, the <i>msqid</i>
argument is not a queue identifier, but instead an index
into the kernel’s internal array that maintains
information about all message queues on the system.</p>
<p style="margin-left:9%;"><b>MSG_STAT_ANY</b>
(Linux-specific, since Linux 4.17)</p>
<p style="margin-left:18%;">Return a <i>msqid_ds</i>
structure as for <b>MSG_STAT</b>. However,
<i>msg_perm.mode</i> is not checked for read access for
<i>msqid</i> meaning that any user can employ this operation
(just as any user may read <i>/proc/sysvipc/msg</i> to
obtain the same information).</p>
<h2>RETURN VALUE
<a name="RETURN VALUE"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">On success,
<b>IPC_STAT</b>, <b>IPC_SET</b>, and <b>IPC_RMID</b> return
0. A successful <b>IPC_INFO</b> or <b>MSG_INFO</b> operation
returns the index of the highest used entry in the
kernel’s internal array recording information about
all message queues. (This information can be used with
repeated <b>MSG_STAT</b> or <b>MSG_STAT_ANY</b> operations
to obtain information about all queues on the system.) A
successful <b>MSG_STAT</b> or <b>MSG_STAT_ANY</b> operation
returns the identifier of the queue whose index was given in
<i>msqid</i>.</p>
<p style="margin-left:9%; margin-top: 1em">On failure,
−1 is returned and <i>errno</i> is set to indicate the
error.</p>
<h2>ERRORS
<a name="ERRORS"></a>
</h2>
<table border="0" cellpadding="0" cellspacing="0" frame="void" rules="none" width="100%">
<tr align="left" valign="top">
<td width="9%"></td>
<td width="8%">
<p style="margin-top: 1em"><b>EACCES</b></p></td>
<td width="1%"></td>
<td width="82%">
<p style="margin-top: 1em">The argument <i>op</i> is equal
to <b>IPC_STAT</b> or <b>MSG_STAT</b>, but the calling
process does not have read permission on the message queue
<i>msqid</i>, and does not have the <b>CAP_IPC_OWNER</b>
capability in the user namespace that governs its IPC
namespace.</p> </td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="8%">
<p><b>EFAULT</b></p></td>
<td width="1%"></td>
<td width="82%">
<p>The argument <i>op</i> has the value <b>IPC_SET</b> or
<b>IPC_STAT</b>, but the address pointed to by <i>buf</i>
isn’t accessible.</p></td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="8%">
<p><b>EIDRM</b></p></td>
<td width="1%"></td>
<td width="82%">
<p>The message queue was removed.</p></td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="8%">
<p><b>EINVAL</b></p></td>
<td width="1%"></td>
<td width="82%">
<p>Invalid value for <i>op</i> or <i>msqid</i>. Or: for a
<b>MSG_STAT</b> operation, the index value specified in
<i>msqid</i> referred to an array slot that is currently
unused.</p> </td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="8%">
<p><b>EPERM</b></p></td>
<td width="1%"></td>
<td width="82%">
<p>The argument <i>op</i> has the value <b>IPC_SET</b> or
<b>IPC_RMID</b>, but the effective user ID of the calling
process is not the creator (as found in
<i>msg_perm.cuid</i>) or the owner (as found in
<i>msg_perm.uid</i>) of the message queue, and the caller is
not privileged (Linux: does not have the
<b>CAP_SYS_ADMIN</b> capability).</p></td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="8%">
<p><b>EPERM</b></p></td>
<td width="1%"></td>
<td width="82%">
<p>An attempt (<b>IPC_SET</b>) was made to increase
<i>msg_qbytes</i> beyond the system parameter <b>MSGMNB</b>,
but the caller is not privileged (Linux: does not have the
<b>CAP_SYS_RESOURCE</b> capability).</p></td></tr>
</table>
<h2>STANDARDS
<a name="STANDARDS"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">POSIX.1-2008.</p>
<h2>HISTORY
<a name="HISTORY"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">POSIX.1-2001,
SVr4.</p>
<p style="margin-left:9%; margin-top: 1em">Various fields
in the <i>struct msqid_ds</i> were typed as <i>short</i>
under Linux 2.2 and have become <i>long</i> under Linux 2.4.
To take advantage of this, a recompilation under
glibc-2.1.91 or later should suffice. (The kernel
distinguishes old and new calls by an <b>IPC_64</b> flag in
<i>op</i>.)</p>
<h2>NOTES
<a name="NOTES"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">The
<b>IPC_INFO</b>, <b>MSG_STAT</b>, and <b>MSG_INFO</b>
operations are used by the <b>ipcs</b>(1) program to provide
information on allocated resources. In the future these may
modified or moved to a <i>/proc</i> filesystem
interface.</p>
<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>msgget</b>(2),
<b>msgrcv</b>(2), <b>msgsnd</b>(2), <b>capabilities</b>(7),
<b>mq_overview</b>(7), <b>sysvipc</b>(7)</p>
<hr/>
</body>
</html>
