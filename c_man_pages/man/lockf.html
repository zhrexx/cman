<!-- Creator     : groff version 1.23.0 -->
<!-- CreationDate: Sat Apr  5 20:46:11 2025 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">

<html>
<head>
<meta content="groff -Thtml, see www.gnu.org" name="generator"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="text/css" name="Content-Style"/>
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>lockf</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><style>
            :root {
                --primary-color: #3498db;
                --background-color: #f9f9f9;
                --text-color: #333;
                --code-bg: #f0f0f0;
                --header-color: #2c3e50;
                --link-color: #2980b9;
            }
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                line-height: 1.6;
                color: var(--text-color);
                background-color: var(--background-color);
                max-width: 900px;
                margin: 0 auto;
                padding: 2rem;
            }
            h1, h2, h3, h4 {
                color: var(--header-color);
            }
            h1 {
                border-bottom: 2px solid var(--primary-color);
                padding-bottom: 0.5rem;
            }
            pre {
                background-color: var(--code-bg);
                padding: 1rem;
                border-radius: 4px;
                overflow-x: auto;
            }
            a {
                color: var(--link-color);
                text-decoration: none;
            }
            a:hover {
                text-decoration: underline;
            }
            .man-navigation {
                background-color: #fff;
                border-bottom: 1px solid #ddd;
                padding: 0.5rem 0;
                position: sticky;
                top: 0;
                z-index: 100;
            }
            .section {
                margin-top: 2rem;
            }
            @media (prefers-color-scheme: dark) {
                :root {
                    --primary-color: #3498db;
                    --background-color: #222;
                    --text-color: #f0f0f0;
                    --code-bg: #333;
                    --header-color: #3498db;
                    --link-color: #5dade2;
                }
            }
            .back-to-index {
                display: inline-block;
                margin: 1rem 0;
                padding: 0.5rem 1rem;
                background-color: var(--primary-color);
                color: white;
                border-radius: 4px;
                text-decoration: none;
            }
            .back-to-index:hover {
                background-color: var(--link-color);
                text-decoration: none;
            }
        </style></head>
<body><div><a class="back-to-index" href="../index.html">← Back to Index</a></div>
<h1 align="center">lockf</h1>
<a href="#NAME">NAME</a><br/>
<a href="#LIBRARY">LIBRARY</a><br/>
<a href="#SYNOPSIS">SYNOPSIS</a><br/>
<a href="#DESCRIPTION">DESCRIPTION</a><br/>
<a href="#RETURN VALUE">RETURN VALUE</a><br/>
<a href="#ERRORS">ERRORS</a><br/>
<a href="#ATTRIBUTES">ATTRIBUTES</a><br/>
<a href="#STANDARDS">STANDARDS</a><br/>
<a href="#HISTORY">HISTORY</a><br/>
<a href="#SEE ALSO">SEE ALSO</a><br/>
<hr/>
<h2>NAME
<a name="NAME"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">lockf −
apply, test or remove a POSIX lock on an open file</p>
<h2>LIBRARY
<a name="LIBRARY"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">Standard C
library (<i>libc</i>, <i>−lc</i>)</p>
<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>#include
&lt;unistd.h&gt;</b></p>
<p style="margin-left:9%; margin-top: 1em"><b>int
lockf(int</b> <i>fd</i><b>, int</b> <i>op</i><b>, off_t</b>
<i>len</i><b>);</b></p>
<p style="margin-left:4%; margin-top: 1em">Feature Test
Macro Requirements for glibc (see
<b>feature_test_macros</b>(7)):</p>
<p style="margin-left:9%; margin-top: 1em"><b>lockf</b>():
<br/>
_XOPEN_SOURCE &gt;= 500 <br/>
|| /* glibc &gt;= 2.19: */ _DEFAULT_SOURCE <br/>
|| /* glibc &lt;= 2.19: */ _BSD_SOURCE || _SVID_SOURCE</p>
<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">Apply, test, or
remove a POSIX lock on a section of an open file. The file
is specified by <i>fd</i>, a file descriptor open for
writing, the action by <i>op</i>, and the section consists
of byte positions <i>pos</i>..<i>pos</i>+<i>len</i>−1
if <i>len</i> is positive, and
<i>pos</i>−<i>len</i>..<i>pos</i>−1 if
<i>len</i> is negative, where <i>pos</i> is the current file
position, and if <i>len</i> is zero, the section extends
from the current file position to infinity, encompassing the
present and future end-of-file positions. In all cases, the
section may extend past current end-of-file.</p>
<p style="margin-left:9%; margin-top: 1em">On Linux,
<b>lockf</b>() is just an interface on top of
<b>fcntl</b>(2) locking. Many other systems implement
<b>lockf</b>() in this way, but note that POSIX.1 leaves the
relationship between <b>lockf</b>() and <b>fcntl</b>(2)
locks unspecified. A portable application should probably
avoid mixing calls to these interfaces.</p>
<p style="margin-left:9%; margin-top: 1em">Valid operations
are given below:</p>
<table border="0" cellpadding="0" cellspacing="0" frame="void" rules="none" width="100%">
<tr align="left" valign="top">
<td width="9%"></td>
<td width="8%">
<p><b>F_LOCK</b></p></td>
<td width="1%"></td>
<td width="82%">
<p>Set an exclusive lock on the specified section of the
file. If (part of) this section is already locked, the call
blocks until the previous lock is released. If this section
overlaps an earlier locked section, both are merged. File
locks are released as soon as the process holding the locks
closes some file descriptor for the file. A child process
does not inherit these locks.</p></td></tr>
</table>
<p style="margin-left:9%;"><b>F_TLOCK</b></p>
<p style="margin-left:18%;">Same as <b>F_LOCK</b> but the
call never blocks and returns an error instead if the file
is already locked.</p>
<p style="margin-left:9%;"><b>F_ULOCK</b></p>
<p style="margin-left:18%;">Unlock the indicated section of
the file. This may cause a locked section to be split into
two locked sections.</p>
<table border="0" cellpadding="0" cellspacing="0" frame="void" rules="none" width="100%">
<tr align="left" valign="top">
<td width="9%"></td>
<td width="8%">
<p><b>F_TEST</b></p></td>
<td width="1%"></td>
<td width="82%">
<p>Test the lock: return 0 if the specified section is
unlocked or locked by this process; return −1, set
<i>errno</i> to <b>EAGAIN</b> (<b>EACCES</b> on some other
systems), if another process holds a lock.</p></td></tr>
</table>
<h2>RETURN VALUE
<a name="RETURN VALUE"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">On success, zero
is returned. On error, −1 is returned, and
<i>errno</i> is set to indicate the error.</p>
<h2>ERRORS
<a name="ERRORS"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>EACCES</b> or
<b>EAGAIN</b></p>
<p style="margin-left:18%;">The file is locked and
<b>F_TLOCK</b> or <b>F_TEST</b> was specified, or the
operation is prohibited because the file has been
memory-mapped by another process.</p>
<table border="0" cellpadding="0" cellspacing="0" frame="void" rules="none" width="100%">
<tr align="left" valign="top">
<td width="9%"></td>
<td width="6%">
<p><b>EBADF</b></p></td>
<td width="3%"></td>
<td width="82%">
<p><i>fd</i> is not an open file descriptor; or <i>op</i>
is <b>F_LOCK</b> or <b>F_TLOCK</b> and <i>fd</i> is not a
writable file descriptor.</p></td></tr>
</table>
<p style="margin-left:9%;"><b>EDEADLK</b></p>
<p style="margin-left:18%;"><i>op</i> was <b>F_LOCK</b> and
this lock operation would cause a deadlock.</p>
<table border="0" cellpadding="0" cellspacing="0" frame="void" rules="none" width="100%">
<tr align="left" valign="top">
<td width="9%"></td>
<td width="8%">
<p><b>EINTR</b></p></td>
<td width="1%"></td>
<td width="82%">
<p>While waiting to acquire a lock, the call was
interrupted by delivery of a signal caught by a handler; see
<b>signal</b>(7).</p> </td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="8%">
<p><b>EINVAL</b></p></td>
<td width="1%"></td>
<td width="82%">
<p>An invalid operation was specified in <i>op</i>.</p></td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="8%">
<p><b>ENOLCK</b></p></td>
<td width="1%"></td>
<td width="82%">
<p>Too many segment locks open, lock table is full.</p></td></tr>
</table>
<h2>ATTRIBUTES
<a name="ATTRIBUTES"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">For an
explanation of the terms used in this section, see
<b>attributes</b>(7).</p>
<h2>STANDARDS
<a name="STANDARDS"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">POSIX.1-2008.</p>
<h2>HISTORY
<a name="HISTORY"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">POSIX.1-2001,
SVr4.</p>
<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>fcntl</b>(2),
<b>flock</b>(2)</p>
<p style="margin-left:9%; margin-top: 1em"><i>locks.txt</i>
and <i>mandatory−locking.txt</i> in the Linux kernel
source directory <i>Documentation/filesystems</i> (on older
kernels, these files are directly under the
<i>Documentation</i> directory, and
<i>mandatory−locking.txt</i> is called
<i>mandatory.txt</i>)</p>
<hr/>
</body>
</html>
