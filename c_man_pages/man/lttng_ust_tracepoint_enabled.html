<!-- Creator     : groff version 1.23.0 -->
<!-- CreationDate: Sat Apr  5 20:46:13 2025 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">

<html>
<head>
<meta content="groff -Thtml, see www.gnu.org" name="generator"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="text/css" name="Content-Style"/>
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>LTTNG−UST</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><style>
            :root {
                --primary-color: #3498db;
                --background-color: #f9f9f9;
                --text-color: #333;
                --code-bg: #f0f0f0;
                --header-color: #2c3e50;
                --link-color: #2980b9;
            }
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                line-height: 1.6;
                color: var(--text-color);
                background-color: var(--background-color);
                max-width: 900px;
                margin: 0 auto;
                padding: 2rem;
            }
            h1, h2, h3, h4 {
                color: var(--header-color);
            }
            h1 {
                border-bottom: 2px solid var(--primary-color);
                padding-bottom: 0.5rem;
            }
            pre {
                background-color: var(--code-bg);
                padding: 1rem;
                border-radius: 4px;
                overflow-x: auto;
            }
            a {
                color: var(--link-color);
                text-decoration: none;
            }
            a:hover {
                text-decoration: underline;
            }
            .man-navigation {
                background-color: #fff;
                border-bottom: 1px solid #ddd;
                padding: 0.5rem 0;
                position: sticky;
                top: 0;
                z-index: 100;
            }
            .section {
                margin-top: 2rem;
            }
            @media (prefers-color-scheme: dark) {
                :root {
                    --primary-color: #3498db;
                    --background-color: #222;
                    --text-color: #f0f0f0;
                    --code-bg: #333;
                    --header-color: #3498db;
                    --link-color: #5dade2;
                }
            }
            .back-to-index {
                display: inline-block;
                margin: 1rem 0;
                padding: 0.5rem 1rem;
                background-color: var(--primary-color);
                color: white;
                border-radius: 4px;
                text-decoration: none;
            }
            .back-to-index:hover {
                background-color: var(--link-color);
                text-decoration: none;
            }
        </style></head>
<body><div><a class="back-to-index" href="../index.html">← Back to Index</a></div>
<h1 align="center">LTTNG−UST</h1>
<a href="#NAME">NAME</a><br/>
<a href="#SYNOPSIS">SYNOPSIS</a><br/>
<a href="#DESCRIPTION">DESCRIPTION</a><br/>
<a href="#Compatibility with previous APIs">Compatibility with previous APIs</a><br/>
<a href="#Creating a tracepoint provider">Creating a tracepoint provider</a><br/>
<a href="#LTTNG_UST_TRACEPOINT_EVENT() usage">LTTNG_UST_TRACEPOINT_EVENT() usage</a><br/>
<a href="#Available field macros">Available field macros</a><br/>
<a href="#LTTNG_UST_TRACEPOINT_ENUM() usage">LTTNG_UST_TRACEPOINT_ENUM() usage</a><br/>
<a href="#LTTNG_UST_TRACEPOINT_EVENT_CLASS() usage">LTTNG_UST_TRACEPOINT_EVENT_CLASS() usage</a><br/>
<a href="#LTTNG_UST_TRACEPOINT_LOGLEVEL() usage">LTTNG_UST_TRACEPOINT_LOGLEVEL() usage</a><br/>
<a href="#Instrumenting your application">Instrumenting your application</a><br/>
<a href="#Statically linking the tracepoint provider">Statically linking the tracepoint provider</a><br/>
<a href="#Dynamically loading the tracepoint provider">Dynamically loading the tracepoint provider</a><br/>
<a href="#Using LTTng−UST with daemons">Using LTTng−UST with daemons</a><br/>
<a href="#Context information">Context information</a><br/>
<a href="#LTTng−UST state dump">LTTng−UST state dump</a><br/>
<a href="#Shared library load/unload tracking">Shared library load/unload tracking</a><br/>
<a href="#Detect if LTTng−UST is loaded">Detect if LTTng−UST is loaded</a><br/>
<a href="#EXAMPLE">EXAMPLE</a><br/>
<a href="#Tracepoint provider header file">Tracepoint provider header file</a><br/>
<a href="#Tracepoint provider source file">Tracepoint provider source file</a><br/>
<a href="#Application header file">Application header file</a><br/>
<a href="#Application source file">Application source file</a><br/>
<a href="#ENVIRONMENT VARIABLES">ENVIRONMENT VARIABLES</a><br/>
<a href="#BUGS">BUGS</a><br/>
<a href="#RESOURCES">RESOURCES</a><br/>
<a href="#COPYRIGHTS">COPYRIGHTS</a><br/>
<a href="#THANKS">THANKS</a><br/>
<a href="#AUTHORS">AUTHORS</a><br/>
<a href="#SEE ALSO">SEE ALSO</a><br/>
<hr/>
<h2>NAME
<a name="NAME"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">lttng-ust
− LTTng user space tracing</p>
<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>#include
&lt;lttng/tracepoint.h&gt;</b></p>
<p style="margin-left:9%; margin-top: 1em">#define
<b>LTTNG_UST_TP_ARGS</b>(<i>args</i>...) <br/>
#define <b>LTTNG_UST_TP_ENUM_VALUES</b>(<i>values</i>...)
<br/>
#define <b>LTTNG_UST_TP_FIELDS</b>(<i>fields</i>...) <br/>
#define <b>LTTNG_UST_TRACEPOINT_ENUM</b>(<i>prov_name</i>,
<i>enum_name</i>, <i>mappings</i>) <br/>
#define <b>LTTNG_UST_TRACEPOINT_EVENT</b>(<i>prov_name</i>,
<i>t_name</i>, <i>args</i>, <i>fields</i>) <br/>
#define
<b>LTTNG_UST_TRACEPOINT_EVENT_CLASS</b>(<i>cls_prov_name</i>,
<i>cls_name</i>, <i><br/>
args</i>, <i>fields</i>) <br/>
#define
<b>LTTNG_UST_TRACEPOINT_EVENT_INSTANCE</b>(<i>cls_prov_name</i>,
<i>cls_name</i>, <i><br/>
inst_prov_name</i>, <i>t_name</i>, <i>args</i>) <br/>
#define
<b>LTTNG_UST_TRACEPOINT_LOGLEVEL</b>(<i>prov_name</i>,
<i>t_name</i>, <i>level</i>) <br/>
#define <b>lttng_ust_do_tracepoint</b>(<i>prov_name</i>,
<i>t_name</i>, ...) <br/>
#define <b>lttng_ust_field_array</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i>count</i>) <br/>
#define
<b>lttng_ust_field_array_nowrite</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i>count</i>) <br/>
#define <b>lttng_ust_field_array_hex</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i>count</i>) <br/>
#define
<b>lttng_ust_field_array_nowrite_hex</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i><br/>
count</i>) <br/>
#define
<b>lttng_ust_field_array_network</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i>count</i>) <br/>
#define
<b>lttng_ust_field_array_network_nowrite</b>(<i>int_type</i>,
<i>field_name</i>, <i><br/>
expr</i>, <i>count</i>) <br/>
#define
<b>lttng_ust_field_array_network_hex</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i><br/>
count</i>) <br/>
#define
<b>lttng_ust_field_array_network_nowrite_hex</b>(<i>int_type</i>,
<i>field_name</i>, <i><br/>
expr</i>, <i>count</i>) <br/>
#define <b>lttng_ust_field_array_text</b>(char,
<i>field_name</i>, <i>expr</i>, <i>count</i>) <br/>
#define <b>lttng_ust_field_array_text_nowrite</b>(char,
<i>field_name</i>, <i>expr</i>, <i><br/>
count</i>) <br/>
#define <b>lttng_ust_field_enum</b>(<i>prov_name</i>,
<i>enum_name</i>, <i>int_type</i>, <i>field_name</i>,
<i><br/>
expr</i>) <br/>
#define
<b>lttng_ust_field_enum_nowrite</b>(<i>prov_name</i>,
<i>enum_name</i>, <i>int_type</i>, <i><br/>
field_name</i>, <i>expr</i>) <br/>
#define <b>lttng_ust_field_enum_value</b>(<i>label</i>,
<i>value</i>) <br/>
#define <b>lttng_ust_field_enum_range</b>(<i>label</i>,
<i>start</i>, <i>end</i>) <br/>
#define <b>lttng_ust_field_float</b>(<i>float_type</i>,
<i>field_name</i>, <i>expr</i>) <br/>
#define
<b>lttng_ust_field_float_nowrite</b>(<i>float_type</i>,
<i>field_name</i>, <i>expr</i>) <br/>
#define <b>lttng_ust_field_integer</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>) <br/>
#define <b>lttng_ust_field_integer_hex</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>) <br/>
#define
<b>lttng_ust_field_integer_network</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>) <br/>
#define
<b>lttng_ust_field_integer_network_hex</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>) <br/>
#define
<b>lttng_ust_field_integer_nowrite</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>) <br/>
#define <b>lttng_ust_field_sequence</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i><br/>
len_type</i>, <i>len_expr</i>) <br/>
#define
<b>lttng_ust_field_sequence_nowrite</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i><br/>
len_type</i>, <i>len_expr</i>) <br/>
#define <b>lttng_ust_field_sequence_hex</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i><br/>
len_type</i>, <i>len_expr</i>) <br/>
#define
<b>lttng_ust_field_sequence_nowrite_hex</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i><br/>
len_type</i>, <i>len_expr</i>) <br/>
#define
<b>lttng_ust_field_sequence_network</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i><br/>
len_type</i>, <i>len_expr</i>) <br/>
#define
<b>lttng_ust_field_sequence_network_nowrite</b>(<i>int_type</i>,
<i>field_name</i>, <i><br/>
expr</i>, <i>len_type</i>, <i><br/>
len_expr</i>) <br/>
#define
<b>lttng_ust_field_sequence_network_hex</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i><br/>
len_type</i>, <i>len_expr</i>) <br/>
#define
<b>lttng_ust_field_sequence_network_nowrite_hex</b>(<i>int_type</i>,
<i><br/>
field_name</i>, <i><br/>
expr</i>, <i>len_type</i>, <i><br/>
len_expr</i>) <br/>
#define <b>lttng_ust_field_sequence_text</b>(char,
<i>field_name</i>, <i>expr</i>, <i>len_type</i>, <i><br/>
len_expr</i>) <br/>
#define <b>lttng_ust_field_sequence_text_nowrite</b>(char,
<i>field_name</i>, <i>expr</i>, <i><br/>
len_type</i>, <i>len_expr</i>) <br/>
#define <b>lttng_ust_field_string</b>(<i>field_name</i>,
<i>expr</i>) <br/>
#define
<b>lttng_ust_field_string_nowrite</b>(<i>field_name</i>,
<i>expr</i>) <br/>
#define <b>lttng_ust_tracepoint</b>(<i>prov_name</i>,
<i>t_name</i>, ...) <br/>
#define
<b>lttng_ust_tracepoint_enabled</b>(<i>prov_name</i>,
<i>t_name</i>)</p>
<p style="margin-left:9%; margin-top: 1em">Link with,
following this manual page:</p>
<p style="margin-left:14%; margin-top: 1em">•
<b>-llttng-ust -ldl</b></p>
<p style="margin-left:14%; margin-top: 1em">• If you
define <b>_LGPL_SOURCE</b> before including
<b>&lt;lttng/tracepoint.h&gt;</b> (directly or indirectly):
<b>-llttng-ust-common</b></p>
<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">The <i>Linux
Trace Toolkit: next generation</i> &lt;http://lttng.org/&gt;
is an open source software package used for correlated
tracing of the Linux kernel, user applications, and user
libraries.</p>
<p style="margin-left:9%; margin-top: 1em">LTTng−UST
is the user space tracing component of the LTTng project. It
is a port to user space of the low−overhead tracing
capabilities of the LTTng Linux kernel tracer. The
<b>liblttng-ust</b> library is used to trace user
applications and libraries.</p>
<p style="margin-left:14%; margin-top: 1em"><b><big>Note</big></b></p>
<p style="margin-left:14%; margin-top: 1em">This man page
is about the <b>liblttng-ust</b> library. The
LTTng−UST project also provides Java and Python
packages to trace applications written in those languages.
How to instrument and trace Java and Python applications is
documented in the online LTTng documentation
&lt;http://lttng.org/docs/&gt;.</p>
<p style="margin-left:9%; margin-top: 1em">There are three
ways to use <b>liblttng-ust</b>:</p>
<p style="margin-left:14%; margin-top: 1em">• Using
the <b>lttng_ust_tracef</b>(3) API, which is similar to
<b>printf</b>(3).</p>
<p style="margin-left:14%; margin-top: 1em">• Using
the <b>lttng_ust_tracelog</b>(3) API, which is
<b>lttng_ust_tracef</b>(3) with a log level parameter.</p>
<p style="margin-left:14%; margin-top: 1em">• Defining
your own tracepoints. See the <i>Creating a tracepoint
provider</i> section below.</p>
<h3>Compatibility with previous APIs
<a name="Compatibility with previous APIs"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em">Since
LTTng−UST 2.13, the
<b>LTTNG_UST_COMPAT_API_VERSION</b> definition controls
which LTTng−UST APIs are available (compiled):</p>
<p style="margin-left:9%; margin-top: 1em">Undefined</p>
<p style="margin-left:14%;">All APIs are available.</p>
<p style="margin-left:9%; margin-top: 1em"><i>N</i> (0 or
positive integer)</p>
<p style="margin-left:14%;">API version <i>N</i>, and
all the following existing APIs, are available. Previous
APIs are not available (not compiled).</p>
<p style="margin-left:9%; margin-top: 1em">The following
table shows the mapping from LTTng−UST versions (up to
LTTng−UST 2.13.8) to available API versions: <br/>
This manual page <b>only</b> documents version 1 of the
API.</p>
<p style="margin-left:9%; margin-top: 1em">If you wish to
have access to version 0 of the API (for example, the
<b>tracepoint()</b>, <b>ctf_integer()</b>, and
<b>TRACEPOINT_EVENT()</b> macros), then either don’t
define <b>LTTNG_UST_COMPAT_API_VERSION</b>, or define it to
<b>0</b> before including any LTTng−UST header.</p>
<h3>Creating a tracepoint provider
<a name="Creating a tracepoint provider"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em">Creating a
tracepoint provider is the first step of using
<b>liblttng-ust</b>. The next steps are:</p>
<p style="margin-left:14%; margin-top: 1em">•
<i>Instrumenting your application with</i>
<b>lttng_ust_tracepoint()</b> calls</p>
<p style="margin-left:14%; margin-top: 1em">• Building
your application with LTTng−UST support, either
<i>statically</i> or <i>dynamically</i>.</p>
<p style="margin-left:9%; margin-top: 1em">A <b>tracepoint
provider</b> is a compiled object containing the event
probes corresponding to your custom tracepoint definitions.
A tracepoint provider contains the code to get the size of
an event and to serialize it, amongst other things.</p>
<p style="margin-left:9%; margin-top: 1em">To create a
tracepoint provider, start with the following <i>tracepoint
provider header</i> template:</p>
<p style="margin-left:14%; margin-top: 1em">#undef
LTTNG_UST_TRACEPOINT_PROVIDER <br/>
#define LTTNG_UST_TRACEPOINT_PROVIDER my_provider</p>
<p style="margin-left:14%; margin-top: 1em">#undef
LTTNG_UST_TRACEPOINT_INCLUDE <br/>
#define LTTNG_UST_TRACEPOINT_INCLUDE "./tp.h"</p>
<p style="margin-left:14%; margin-top: 1em">#if
!defined(_TP_H) || \ <br/>
defined(LTTNG_UST_TRACEPOINT_HEADER_MULTI_READ) <br/>
#define _TP_H</p>
<p style="margin-left:14%; margin-top: 1em">#include
&lt;lttng/tracepoint.h&gt;</p>
<p style="margin-left:14%; margin-top: 1em">/* <br/>
* LTTNG_UST_TRACEPOINT_EVENT(),
LTTNG_UST_TRACEPOINT_EVENT_CLASS(), <br/>
* LTTNG_UST_TRACEPOINT_EVENT_INSTANCE(), <br/>
* LTTNG_UST_TRACEPOINT_LOGLEVEL(), and
‘LTTNG_UST_TRACEPOINT_ENUM()‘ <br/>
* are used here. <br/>
*/</p>
<p style="margin-left:14%; margin-top: 1em">#endif /* _TP_H
*/</p>
<p style="margin-left:14%; margin-top: 1em">#include
&lt;lttng/tracepoint−event.h&gt;</p>
<p style="margin-left:9%; margin-top: 1em">In this
template, the tracepoint provider is named
<b>my_provider</b> (<b>LTTNG_UST_TRACEPOINT_PROVIDER</b>
definition). The file needs to bear the name of the
<b>LTTNG_UST_TRACEPOINT_INCLUDE</b> definition (<b>tp.h</b>
in this case). Between <b>#include
&lt;lttng/tracepoint.h&gt;</b> and <b>#endif</b> go the
invocations of the <b>LTTNG_UST_TRACEPOINT_EVENT()</b>,
<b>LTTNG_UST_TRACEPOINT_EVENT_CLASS()</b>,
<b>LTTNG_UST_TRACEPOINT_EVENT_INSTANCE()</b>,
<b>LTTNG_UST_TRACEPOINT_LOGLEVEL()</b>, and
<b>LTTNG_UST_TRACEPOINT_ENUM()</b> macros.</p>
<p style="margin-left:14%; margin-top: 1em"><b><big>Note</big></b></p>
<p style="margin-left:14%; margin-top: 1em">You can avoid
writing the prologue and epilogue boilerplate in the
template file above by using the <b>lttng-gen-tp</b>(1) tool
shipped with LTTng−UST.</p>
<p style="margin-left:9%; margin-top: 1em">The tracepoint
provider header file needs to be included in a source file
which looks like this:</p>
<p style="margin-left:14%; margin-top: 1em">#define
LTTNG_UST_TRACEPOINT_CREATE_PROBES</p>
<p style="margin-left:14%; margin-top: 1em">#include
"tp.h"</p>
<p style="margin-left:9%; margin-top: 1em">Together, those
two files (let’s call them <b>tp.h</b> and
<b>tp.c</b>) form the tracepoint provider sources, ready to
be compiled.</p>
<p style="margin-left:9%; margin-top: 1em">You can create
multiple tracepoint providers to be used in a single
application, but each one must have its own header file.</p>
<p style="margin-left:9%; margin-top: 1em">The
<b>LTTNG_UST_TRACEPOINT_EVENT()</b> usage section below
shows how to use the <b>LTTNG_UST_TRACEPOINT_EVENT()</b>
macro to define the actual tracepoints in the tracepoint
provider header file.</p>
<p style="margin-left:9%; margin-top: 1em">See the
<i>EXAMPLE</i> section below for a complete example.</p>
<h3>LTTNG_UST_TRACEPOINT_EVENT() usage
<a name="LTTNG_UST_TRACEPOINT_EVENT() usage"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em">The
<b>LTTNG_UST_TRACEPOINT_EVENT()</b> macro is used in a
template provider header file (see the <i>Creating a
tracepoint provider</i> section above) to define
LTTng−UST tracepoints.</p>
<p style="margin-left:9%; margin-top: 1em">The
<b>LTTNG_UST_TRACEPOINT_EVENT()</b> usage template is as
follows:</p>
<p style="margin-left:14%; margin-top: 1em">LTTNG_UST_TRACEPOINT_EVENT(
<br/>
/* Tracepoint provider name */ <br/>
my_provider,</p>
<p style="margin-left:14%; margin-top: 1em">/*
Tracepoint/event name */ <br/>
my_tracepoint,</p>
<p style="margin-left:14%; margin-top: 1em">/* List of
tracepoint arguments (input) */ <br/>
LTTNG_UST_TP_ARGS( <br/>
... <br/>
),</p>
<p style="margin-left:14%; margin-top: 1em">/* List of
fields of eventual event (output) */ <br/>
LTTNG_UST_TP_FIELDS( <br/>
... <br/>
) <br/>
)</p>
<p style="margin-left:9%; margin-top: 1em">The
<b>LTTNG_UST_TP_ARGS()</b> macro contains the input
arguments of the tracepoint. Those arguments can be used in
the argument expressions of the output fields defined in
<b>LTTNG_UST_TP_FIELDS()</b>.</p>
<p style="margin-left:9%; margin-top: 1em">The format of
the <b>LTTNG_UST_TP_ARGS()</b> parameters is: C type, then
argument name; repeat as needed, up to ten times. For
example:</p>
<p style="margin-left:14%; margin-top: 1em">LTTNG_UST_TP_ARGS(
<br/>
int, my_int, <br/>
const char *, my_string, <br/>
FILE *, my_file, <br/>
double, my_float, <br/>
struct my_data *, my_data <br/>
)</p>
<p style="margin-left:9%; margin-top: 1em">The
<b>LTTNG_UST_TP_FIELDS()</b> macro contains the output
fields of the tracepoint, that is, the actual data that can
be recorded in the payload of an event emitted by this
tracepoint.</p>
<p style="margin-left:9%; margin-top: 1em">The
<b>LTTNG_UST_TP_FIELDS()</b> macro contains a list of
<b>lttng_ust_field_*()</b> macros NOT separated by commas.
The available macros are documented in the <i>Available</i>
<b>lttng_ust_field_*()</b> field type macros section
below.</p>
<h3>Available field macros
<a name="Available field macros"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em">This section
documents the available <b>lttng_ust_field_*()</b> macros
that can be inserted in the <b>LTTNG_UST_TP_FIELDS()</b>
macro of the <b>LTTNG_UST_TRACEPOINT_EVENT()</b> macro.</p>
<p style="margin-left:9%; margin-top: 1em">Standard
integer, displayed in base 10:</p>
<p style="margin-left:14%; margin-top: 1em"><b>lttng_ust_field_integer</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>) <b><br/>
lttng_ust_field_integer_nowrite</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>)</p>
<p style="margin-left:9%; margin-top: 1em">Standard
integer, displayed in base 16:</p>
<p style="margin-left:14%; margin-top: 1em"><b>lttng_ust_field_integer_hex</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>)</p>
<p style="margin-left:9%; margin-top: 1em">Integer in
network byte order (big endian), displayed in base 10:</p>
<p style="margin-left:14%; margin-top: 1em"><b>lttng_ust_field_integer_network</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>)</p>
<p style="margin-left:9%; margin-top: 1em">Integer in
network byte order, displayed in base 16:</p>
<p style="margin-left:14%; margin-top: 1em"><b>lttng_ust_field_integer_network_hex</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>)</p>
<p style="margin-left:9%; margin-top: 1em">Floating point
number:</p>
<p style="margin-left:14%; margin-top: 1em"><b>lttng_ust_field_float</b>(<i>float_type</i>,
<i>field_name</i>, <i>expr</i>) <b><br/>
lttng_ust_field_float_nowrite</b>(<i>float_type</i>,
<i>field_name</i>, <i>expr</i>)</p>
<p style="margin-left:9%; margin-top: 1em">Null−terminated
string:</p>
<p style="margin-left:14%; margin-top: 1em"><b>lttng_ust_field_string</b>(<i>field_name</i>,
<i>expr</i>) <b><br/>
lttng_ust_field_string_nowrite</b>(<i>field_name</i>,
<i>expr</i>)</p>
<p style="margin-left:9%; margin-top: 1em">Statically−sized
array of integers (<b>_hex</b> versions displayed in
hexadecimal, <b>_network</b> versions in network byte
order):</p>
<p style="margin-left:14%; margin-top: 1em"><b>lttng_ust_field_array</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i>count</i>) <b><br/>
lttng_ust_field_array_nowrite</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i>count</i>) <b><br/>
lttng_ust_field_array_hex</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i>count</i>) <b><br/>
lttng_ust_field_array_nowrite_hex</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i>count</i>) <b><br/>
lttng_ust_field_array_network</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i>count</i>) <b><br/>
lttng_ust_field_array_network_nowrite</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i><br/>
count</i>) <b><br/>
lttng_ust_field_array_network_hex</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i>count</i>) <b><br/>

lttng_ust_field_array_network_nowrite_hex</b>(<i>int_type</i>,
<i>field_name</i>, <i><br/>
expr</i>, <i>count</i>)</p>
<p style="margin-left:9%; margin-top: 1em">Statically−sized
array, printed as text; no need to be
null−terminated:</p>
<p style="margin-left:14%; margin-top: 1em"><b>lttng_ust_field_array_text</b>(char,
<i>field_name</i>, <i>expr</i>, <i>count</i>) <b><br/>
lttng_ust_field_array_text_nowrite</b>(char,
<i>field_name</i>, <i>expr</i>, <i>count</i>)</p>
<p style="margin-left:9%; margin-top: 1em">Dynamically−sized
array of integers (<b>_hex</b> versions displayed in
hexadecimal, <b>_network</b> versions in network byte
order):</p>
<p style="margin-left:14%; margin-top: 1em"><b>lttng_ust_field_sequence</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i>len_type</i>, <i><br/>
len_expr</i>) <b><br/>
lttng_ust_field_sequence_nowrite</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i><br/>
len_type</i>, <i>len_expr</i>) <b><br/>
lttng_ust_field_sequence_hex</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i>len_type</i>, <i><br/>
len_expr</i>) <b><br/>
lttng_ust_field_sequence_nowrite_hex</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i><br/>
len_type</i>, <i>len_expr</i>) <b><br/>
lttng_ust_field_sequence_network</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i><br/>
len_type</i>, <i>len_expr</i>) <b><br/>

lttng_ust_field_sequence_network_nowrite</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i><br/>
len_type</i>, <i>len_expr</i>) <b><br/>
lttng_ust_field_sequence_network_hex</b>(<i>int_type</i>,
<i>field_name</i>, <i>expr</i>, <i><br/>
len_type</i>, <i>len_expr</i>) <b><br/>

lttng_ust_field_sequence_network_nowrite_hex</b>(<i>int_type</i>,
<i>field_name</i>, <i><br/>
expr</i>, <i>len_type</i>, <i><br/>
len_expr</i>)</p>
<p style="margin-left:9%; margin-top: 1em">Dynamically−sized
array, displayed as text; no need to be
null−terminated:</p>
<p style="margin-left:14%; margin-top: 1em"><b>lttng_ust_field_sequence_text</b>(char,
<i>field_name</i>, <i>expr</i>, <i>len_type</i>, <i><br/>
len_expr</i>) <b><br/>
lttng_ust_field_sequence_text_nowrite</b>(char,
<i>field_name</i>, <i>expr</i>, <i><br/>
len_type</i>, <i>len_expr</i>)</p>
<p style="margin-left:9%; margin-top: 1em">Enumeration. The
enumeration field must be defined before using this macro
with the <b>LTTNG_UST_TRACEPOINT_ENUM()</b> macro. See the
<b>LTTNG_UST_TRACEPOINT_ENUM()</b> usage section for more
information.</p>
<p style="margin-left:14%; margin-top: 1em"><b>lttng_ust_field_enum</b>(<i>prov_name</i>,
<i>enum_name</i>, <i>int_type</i>, <i>field_name</i>,
<i><br/>
expr</i>) <b><br/>
lttng_ust_field_enum_nowrite</b>(<i>prov_name</i>,
<i>enum_name</i>, <i>int_type</i>, <i><br/>
field_name</i>, <i>expr</i>)</p>
<p style="margin-left:9%; margin-top: 1em">The parameters
are:</p>
<p style="margin-left:9%; margin-top: 1em"><i>count</i></p>
<p style="margin-left:14%;">Number of elements in
array/sequence. This must be known at compile time.</p>
<p style="margin-left:9%; margin-top: 1em"><i>enum_name</i></p>
<p style="margin-left:14%;">Name of an enumeration field
previously defined with the
<b>LTTNG_UST_TRACEPOINT_ENUM()</b> macro. See the
<b>LTTNG_UST_TRACEPOINT_ENUM()</b> usage section for more
information.</p>
<p style="margin-left:9%; margin-top: 1em"><i>expr</i></p>
<p style="margin-left:14%;">C expression resulting in the
field’s value. This expression can use one or more
arguments passed to the tracepoint. The arguments of a given
tracepoint are defined in the <b>LTTNG_UST_TP_ARGS()</b>
macro (see the <i>Creating a tracepoint provider</i> section
above).</p>
<p style="margin-left:9%; margin-top: 1em"><i>field_name</i></p>
<p style="margin-left:14%;">Event field name (C identifier
syntax, NOT a literal string).</p>
<p style="margin-left:9%; margin-top: 1em"><i>float_type</i></p>
<p style="margin-left:14%;">Float C type (<b>float</b> or
<b>double</b>). The size of this type determines the size of
the floating point number field.</p>
<p style="margin-left:9%; margin-top: 1em"><i>int_type</i></p>
<p style="margin-left:14%;">Integer C type. The size of
this type determines the size of the integer/enumeration
field.</p>
<p style="margin-left:9%; margin-top: 1em"><i>len_expr</i></p>
<p style="margin-left:14%;">C expression resulting in the
sequence’s length. This expression can use one or more
arguments passed to the tracepoint.</p>
<p style="margin-left:9%; margin-top: 1em"><i>len_type</i></p>
<p style="margin-left:14%;">Unsigned integer C type of
sequence’s length.</p>
<p style="margin-left:9%; margin-top: 1em"><i>prov_name</i></p>
<p style="margin-left:14%;">Tracepoint provider name. This
must be the same as the tracepoint provider name used in a
previous field definition.</p>
<p style="margin-left:9%; margin-top: 1em">The
<b>_nowrite</b> versions omit themselves from the recorded
trace, but are otherwise identical. Their primary purpose is
to make some of the event context available to the event
filters without having to commit the data to
sub−buffers. See <b>lttng-enable-event</b>(1) to learn
more about dynamic event filtering.</p>
<p style="margin-left:9%; margin-top: 1em">See the
<i>EXAMPLE</i> section below for a complete example.</p>
<h3>LTTNG_UST_TRACEPOINT_ENUM() usage
<a name="LTTNG_UST_TRACEPOINT_ENUM() usage"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em">An enumeration
field is a list of mappings between an integers, or a range
of integers, and strings (sometimes called <i>labels</i> or
<i>enumerators</i>). Enumeration fields can be used to have
a more compact trace when the possible values for a field
are limited.</p>
<p style="margin-left:9%; margin-top: 1em">An enumeration
field is defined with the <b>LTTNG_UST_TRACEPOINT_ENUM()</b>
macro:</p>
<p style="margin-left:14%; margin-top: 1em">LTTNG_UST_TRACEPOINT_ENUM(
<br/>
/* Tracepoint provider name */ <br/>
my_provider,</p>
<p style="margin-left:14%; margin-top: 1em">/* Enumeration
name (unique in the whole tracepoint provider) */ <br/>
my_enum,</p>
<p style="margin-left:14%; margin-top: 1em">/* Enumeration
mappings */ <br/>
LTTNG_UST_TP_ENUM_VALUES( <br/>
... <br/>
) <br/>
)</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_TP_ENUM_VALUES()</b>
contains a list of enumeration mappings, NOT separated by
commas. Two macros can be used in the
<b>LTTNG_UST_TP_ENUM_VALUES()</b>:
<b>lttng_ust_field_enum_value()</b> and
<b>lttng_ust_field_enum_range()</b>.</p>
<p style="margin-left:9%; margin-top: 1em"><b>lttng_ust_field_enum_value()</b>
is a single value mapping:</p>
<p style="margin-left:14%; margin-top: 1em"><b>lttng_ust_field_enum_value</b>(<i>label</i>,
<i>value</i>)</p>
<p style="margin-left:9%; margin-top: 1em">This macro maps
the given <i>label</i> string to the value <i>value</i>.</p>
<p style="margin-left:9%; margin-top: 1em"><b>lttng_ust_field_enum_range()</b>
is a range mapping:</p>
<p style="margin-left:14%; margin-top: 1em"><b>lttng_ust_field_enum_range</b>(<i>label</i>,
<i>start</i>, <i>end</i>)</p>
<p style="margin-left:9%; margin-top: 1em">This macro maps
the given <i>label</i> string to the range of integers from
<i>start</i> to <i>end</i>, inclusively. Range mappings may
overlap, but the behaviour is implementation−defined:
each trace reader handles overlapping ranges as it
wishes.</p>
<p style="margin-left:9%; margin-top: 1em">See the
<i>EXAMPLE</i> section below for a complete example.</p>
<h3>LTTNG_UST_TRACEPOINT_EVENT_CLASS() usage
<a name="LTTNG_UST_TRACEPOINT_EVENT_CLASS() usage"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em">A <b>tracepoint
class</b> is a class of tracepoints sharing the same field
types and names. A tracepoint instance is one instance of
such a declared tracepoint class, with its own event
name.</p>
<p style="margin-left:9%; margin-top: 1em">LTTng−UST
creates one event serialization function per tracepoint
class. Using <b>LTTNG_UST_TRACEPOINT_EVENT()</b> creates one
tracepoint class per tracepoint definition, whereas using
<b>LTTNG_UST_TRACEPOINT_EVENT_CLASS()</b> and
<b>LTTNG_UST_TRACEPOINT_EVENT_INSTANCE()</b> creates one
tracepoint class, and one or more tracepoint instances of
this class. In other words, many tracepoints can reuse the
same serialization code. Reusing the same code, when
possible, can reduce cache pollution, thus improve
performance.</p>
<p style="margin-left:9%; margin-top: 1em">The
<b>LTTNG_UST_TRACEPOINT_EVENT_CLASS()</b> macro accepts the
same parameters as the <b>LTTNG_UST_TRACEPOINT_EVENT()</b>
macro, except that instead of an event name, its second
parameter is the <i>tracepoint class name</i>:</p>
<p style="margin-left:14%; margin-top: 1em">#define
LTTNG_UST_TRACEPOINT_PROVIDER my_provider</p>
<p style="margin-left:14%; margin-top: 1em">/* ... */</p>
<p style="margin-left:14%; margin-top: 1em">LTTNG_UST_TRACEPOINT_EVENT_CLASS(
<br/>
/* Tracepoint class provider name */ <br/>
my_provider,</p>
<p style="margin-left:14%; margin-top: 1em">/* Tracepoint
class name */ <br/>
my_tracepoint_class,</p>
<p style="margin-left:14%; margin-top: 1em">/* List of
tracepoint arguments (input) */ <br/>
LTTNG_UST_TP_ARGS( <br/>
... <br/>
),</p>
<p style="margin-left:14%; margin-top: 1em">/* List of
fields of eventual event (output) */ <br/>
LTTNG_UST_TP_FIELDS( <br/>
... <br/>
) <br/>
)</p>
<p style="margin-left:9%; margin-top: 1em">Once the
tracepoint class is defined, you can create as many
tracepoint instances as needed:</p>
<p style="margin-left:14%; margin-top: 1em">#define
LTTNG_UST_TRACEPOINT_PROVIDER natality</p>
<p style="margin-left:14%; margin-top: 1em">/* ... */</p>
<p style="margin-left:14%; margin-top: 1em">LTTNG_UST_TRACEPOINT_EVENT_INSTANCE(
<br/>
/* Name of the tracepoint class provider */ <br/>
my_provider,</p>
<p style="margin-left:14%; margin-top: 1em">/* Tracepoint
class name */ <br/>
my_tracepoint_class,</p>
<p style="margin-left:14%; margin-top: 1em">/* Name of the
local (instance) tracepoint provider */ <br/>
natality,</p>
<p style="margin-left:14%; margin-top: 1em">/*
Tracepoint/event name */ <br/>
my_tracepoint,</p>
<p style="margin-left:14%; margin-top: 1em">/* List of
tracepoint arguments (input) */ <br/>
LTTNG_UST_TP_ARGS( <br/>
... <br/>
) <br/>
)</p>
<p style="margin-left:9%; margin-top: 1em">As you can see,
the <b>LTTNG_UST_TRACEPOINT_EVENT_INSTANCE()</b> does not
contain the <b>LTTNG_UST_TP_FIELDS()</b> macro, because they
are defined at the <b>LTTNG_UST_TRACEPOINT_EVENT_CLASS()</b>
level.</p>
<p style="margin-left:9%; margin-top: 1em">Note that the
<b>LTTNG_UST_TRACEPOINT_EVENT_INSTANCE()</b> macro requires
two provider names:</p>
<p style="margin-left:14%; margin-top: 1em">• The name
of the tracepoint class provider (<b>my_provider</b> in the
example above).</p>
<p style="margin-left:14%; margin-top: 1em">This is the
same as the first argument of the
<b>LTTNG_UST_TRACEPOINT_EVENT_CLASS()</b> expansion to refer
to.</p>
<p style="margin-left:14%; margin-top: 1em">• The name
of the local, or instance, provider (<b>natality</b> in the
example above).</p>
<p style="margin-left:14%; margin-top: 1em">This is the
provider name which becomes the prefix part of the name of
the events which such a tracepoint creates.</p>
<p style="margin-left:9%; margin-top: 1em">The two provider
names may be different if the tracepoint class and the
tracepoint instance macros are in two different translation
units.</p>
<p style="margin-left:9%; margin-top: 1em">See the
<i>EXAMPLE</i> section below for a complete example.</p>
<h3>LTTNG_UST_TRACEPOINT_LOGLEVEL() usage
<a name="LTTNG_UST_TRACEPOINT_LOGLEVEL() usage"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em">Optionally, a
<b>log level</b> can be assigned to a defined tracepoint.
Assigning different levels of severity to tracepoints can be
useful: when controlling tracing sessions, you can choose to
only enable events falling into a specific log level range
using the <b>--loglevel</b> and <b>--loglevel-only</b>
options of the <b>lttng-enable-event</b>(1) command.</p>
<p style="margin-left:9%; margin-top: 1em">Log levels are
assigned to tracepoints that are already defined using the
<b>LTTNG_UST_TRACEPOINT_LOGLEVEL()</b> macro. The latter
must be used after having used
<b>LTTNG_UST_TRACEPOINT_EVENT()</b> or
<b>LTTNG_UST_TRACEPOINT_EVENT_INSTANCE()</b> for a given
tracepoint. The <b>LTTNG_UST_TRACEPOINT_LOGLEVEL()</b> macro
is used as follows:</p>
<p style="margin-left:14%; margin-top: 1em">LTTNG_UST_TRACEPOINT_LOGLEVEL(
<br/>
/* Tracepoint provider name */ <br/>
my_provider,</p>
<p style="margin-left:14%; margin-top: 1em">/*
Tracepoint/event name */ <br/>
my_tracepoint,</p>
<p style="margin-left:14%; margin-top: 1em">/* Log level */
<br/>
LTTNG_UST_TRACEPOINT_LOGLEVEL_INFO <br/>
)</p>
<p style="margin-left:9%; margin-top: 1em">The available
log level definitions are:</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_TRACEPOINT_LOGLEVEL_EMERG</b></p>
<p style="margin-left:14%;">System is unusable.</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_TRACEPOINT_LOGLEVEL_ALERT</b></p>
<p style="margin-left:14%;">Action must be taken
immediately.</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_TRACEPOINT_LOGLEVEL_CRIT</b></p>
<p style="margin-left:14%;">Critical conditions.</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_TRACEPOINT_LOGLEVEL_ERR</b></p>
<p style="margin-left:14%;">Error conditions.</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_TRACEPOINT_LOGLEVEL_WARNING</b></p>
<p style="margin-left:14%;">Warning conditions.</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_TRACEPOINT_LOGLEVEL_NOTICE</b></p>
<p style="margin-left:14%;">Normal, but significant,
condition.</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_TRACEPOINT_LOGLEVEL_INFO</b></p>
<p style="margin-left:14%;">Informational message.</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_TRACEPOINT_LOGLEVEL_DEBUG_SYSTEM</b></p>
<p style="margin-left:14%;">Debug information with
system−level scope (set of programs).</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_TRACEPOINT_LOGLEVEL_DEBUG_PROGRAM</b></p>
<p style="margin-left:14%;">Debug information with
program−level scope (set of processes).</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_TRACEPOINT_LOGLEVEL_DEBUG_PROCESS</b></p>
<p style="margin-left:14%;">Debug information with
process−level scope (set of modules).</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_TRACEPOINT_LOGLEVEL_DEBUG_MODULE</b></p>
<p style="margin-left:14%;">Debug information with module
(executable/library) scope (set of units).</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_TRACEPOINT_LOGLEVEL_DEBUG_UNIT</b></p>
<p style="margin-left:14%;">Debug information with
compilation unit scope (set of functions).</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_TRACEPOINT_LOGLEVEL_DEBUG_FUNCTION</b></p>
<p style="margin-left:14%;">Debug information with
function−level scope.</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_TRACEPOINT_LOGLEVEL_DEBUG_LINE</b></p>
<p style="margin-left:14%;">Debug information with
line−level scope (default log level).</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_TRACEPOINT_LOGLEVEL_DEBUG</b></p>
<p style="margin-left:14%;">Debug−level message.</p>
<p style="margin-left:9%; margin-top: 1em">See the
<i>EXAMPLE</i> section below for a complete example.</p>
<h3>Instrumenting your application
<a name="Instrumenting your application"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em">Once the
tracepoint provider is created (see the <i>Creating a
tracepoint provider</i> section above), you can instrument
your application with the defined tracepoints thanks to the
<b>lttng_ust_tracepoint()</b> macro:</p>
<p style="margin-left:14%; margin-top: 1em">#define
<b>lttng_ust_tracepoint</b>(<i>prov_name</i>, <i>t_name</i>,
...)</p>
<p style="margin-left:9%; margin-top: 1em">With:</p>
<p style="margin-left:9%; margin-top: 1em"><i>prov_name</i></p>
<p style="margin-left:14%;">Tracepoint provider name.</p>
<p style="margin-left:9%; margin-top: 1em"><i>t_name</i></p>
<p style="margin-left:14%;">Tracepoint/event name.</p>
<p style="margin-left:9%; margin-top: 1em"><b>...</b></p>
<p style="margin-left:14%;">Tracepoint arguments, if
any.</p>
<p style="margin-left:9%; margin-top: 1em">Make sure to
include the tracepoint provider header file anywhere you use
<b>lttng_ust_tracepoint()</b> for this provider.</p>
<p style="margin-left:14%; margin-top: 1em"><b><big>Note</big></b></p>
<p style="margin-left:14%; margin-top: 1em">Even though
LTTng−UST supports <b>lttng_ust_tracepoint()</b> call
site duplicates having the same provider and tracepoint
names, it is recommended to use a provider/tracepoint name
pair only once within the application source code to help
map events back to their call sites when analyzing the
trace.</p>
<p style="margin-left:9%; margin-top: 1em">Sometimes,
arguments to the tracepoint are expensive to compute (take
call stack, for example). To avoid the computation when the
tracepoint is disabled, you can use the
<b>lttng_ust_tracepoint_enabled()</b> and
<b>lttng_ust_do_tracepoint()</b> macros:</p>
<p style="margin-left:14%; margin-top: 1em">#define
<b>lttng_ust_tracepoint_enabled</b>(<i>prov_name</i>,
<i>t_name</i>) <br/>
#define <b>lttng_ust_do_tracepoint</b>(<i>prov_name</i>,
<i>t_name</i>, ...)</p>
<p style="margin-left:9%; margin-top: 1em"><b>lttng_ust_tracepoint_enabled()</b>
returns a non−zero value if the tracepoint named
<i>t_name</i> from the provider named <i>prov_name</i> is
enabled at run time.</p>
<p style="margin-left:9%; margin-top: 1em"><b>lttng_ust_do_tracepoint()</b>
is like <b>lttng_ust_tracepoint()</b>, except that it
doesn’t check if the tracepoint is enabled. Using
<b>lttng_ust_tracepoint()</b> with
<b>lttng_ust_tracepoint_enabled()</b> is dangerous since
<b>lttng_ust_tracepoint()</b> also contains the
<b>lttng_ust_tracepoint_enabled()</b> check, thus a race
condition is possible in this situation:</p>
<p style="margin-left:14%; margin-top: 1em">if
(lttng_ust_tracepoint_enabled(my_provider, my_tracepoint)) {
<br/>
stuff = prepare_stuff(); <br/>
}</p>
<p style="margin-left:14%; margin-top: 1em">lttng_ust_tracepoint(my_provider,
my_tracepoint, stuff);</p>
<p style="margin-left:9%; margin-top: 1em">If the
tracepoint is enabled after the condition, then <b>stuff</b>
is not prepared: the emitted event will either contain wrong
data, or the whole application could crash (segmentation
fault, for example).</p>
<p style="margin-left:14%; margin-top: 1em"><b><big>Note</big></b></p>
<p style="margin-left:14%; margin-top: 1em">Neither
<b>lttng_ust_tracepoint_enabled()</b> nor
<b>lttng_ust_do_tracepoint()</b> have a <b>STAP_PROBEV()</b>
call, so if you need it, you should emit this call
yourself.</p>
<h3>Statically linking the tracepoint provider
<a name="Statically linking the tracepoint provider"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em">With the static
linking method, compiled tracepoint providers are copied
into the target application.</p>
<p style="margin-left:9%; margin-top: 1em">Define
<b>LTTNG_UST_TRACEPOINT_DEFINE</b> definition below the
<b>LTTNG_UST_TRACEPOINT_CREATE_PROBES</b> definition in the
tracepoint provider source:</p>
<p style="margin-left:14%; margin-top: 1em">#define
LTTNG_UST_TRACEPOINT_CREATE_PROBES <br/>
#define LTTNG_UST_TRACEPOINT_DEFINE</p>
<p style="margin-left:14%; margin-top: 1em">#include
"tp.h"</p>
<p style="margin-left:9%; margin-top: 1em">Create the
tracepoint provider object file:</p>
<p style="margin-left:14%; margin-top: 1em">$ cc −c
−I. tp.c</p>
<p style="margin-left:14%; margin-top: 1em"><b><big>Note</big></b></p>
<p style="margin-left:14%; margin-top: 1em">Although an
application instrumented with LTTng−UST tracepoints
can be compiled with a C++ compiler, tracepoint probes
should be compiled with a C compiler.</p>
<p style="margin-left:9%; margin-top: 1em">At this point,
you <i>can</i> archive this tracepoint provider object file,
possibly with other object files of your application or with
other tracepoint provider object files, as a static
library:</p>
<p style="margin-left:14%; margin-top: 1em">$ ar rc tp.a
tp.o</p>
<p style="margin-left:9%; margin-top: 1em">Using a static
library does have the advantage of centralising the
tracepoint providers objects so they can be shared between
multiple applications. This way, when the tracepoint
provider is modified, the source code changes don’t
have to be patched into each application’s source code
tree. The applications need to be relinked after each
change, but need not to be otherwise recompiled (unless the
tracepoint provider’s API changes).</p>
<p style="margin-left:9%; margin-top: 1em">Then, link your
application with this object file (or with the static
library containing it) and with <b>liblttng-ust</b> and
<b>libdl</b> (<b>libc</b> on a BSD system):</p>
<p style="margin-left:14%; margin-top: 1em">$ cc −o
app tp.o app.o −llttng−ust −ldl</p>
<h3>Dynamically loading the tracepoint provider
<a name="Dynamically loading the tracepoint provider"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em">The second
approach to package the tracepoint provider is to use the
dynamic loader: the library and its member functions are
explicitly sought, loaded at run time.</p>
<p style="margin-left:9%; margin-top: 1em">In this
scenario, the tracepoint provider is compiled as a shared
object.</p>
<p style="margin-left:9%; margin-top: 1em">The process to
create the tracepoint provider shared object is pretty much
the same as the <i>static linking method</i>, except
that:</p>
<p style="margin-left:14%; margin-top: 1em">• Since
the tracepoint provider is not part of the application,
<b>LTTNG_UST_TRACEPOINT_DEFINE</b> must be defined, for each
tracepoint provider, in exactly one source file of the
<i>application</i></p>
<p style="margin-left:14%; margin-top: 1em">•
<b>LTTNG_UST_TRACEPOINT_PROBE_DYNAMIC_LINKAGE</b> must be
defined next to <b>LTTNG_UST_TRACEPOINT_DEFINE</b></p>
<p style="margin-left:9%; margin-top: 1em">Regarding
<b>LTTNG_UST_TRACEPOINT_DEFINE</b> and
<b>LTTNG_UST_TRACEPOINT_PROBE_DYNAMIC_LINKAGE</b>, the
recommended practice is to use a separate C source file in
your application to define them, then include the tracepoint
provider header files afterwards. For example, as
<b>tp-define.c</b>:</p>
<p style="margin-left:14%; margin-top: 1em">#define
LTTNG_UST_TRACEPOINT_DEFINE <br/>
#define LTTNG_UST_TRACEPOINT_PROBE_DYNAMIC_LINKAGE</p>
<p style="margin-left:14%; margin-top: 1em">#include
"tp.h"</p>
<p style="margin-left:9%; margin-top: 1em">The tracepoint
provider object file used to create the shared library is
built like it is using the static linking method, but with
the <b>-fpic</b> option:</p>
<p style="margin-left:14%; margin-top: 1em">$ cc −c
−fpic −I. tp.c</p>
<p style="margin-left:9%; margin-top: 1em">It is then
linked as a shared library like this:</p>
<p style="margin-left:14%; margin-top: 1em">$ cc
−shared
−Wl,−−no−as−needed −o
tp.so tp.o −llttng−ust</p>
<p style="margin-left:9%; margin-top: 1em">This tracepoint
provider shared object isn’t linked with the user
application: it must be loaded manually. This is why the
application is built with no mention of this tracepoint
provider, but still needs libdl:</p>
<p style="margin-left:14%; margin-top: 1em">$ cc −o
app app.o tp−define.o −ldl</p>
<p style="margin-left:9%; margin-top: 1em">There are two
ways to dynamically load the tracepoint provider shared
object:</p>
<p style="margin-left:14%; margin-top: 1em">• Load it
manually from the application using <b>dlopen</b>(3)</p>
<p style="margin-left:14%; margin-top: 1em">• Make the
dynamic loader load it with the <b>LD_PRELOAD</b>
environment variable (see <b>ld.so</b>(8))</p>
<p style="margin-left:9%; margin-top: 1em">If the
application does not dynamically load the tracepoint
provider shared object using one of the methods above,
tracing is disabled for this application, and the events are
not listed in the output of <b>lttng-list</b>(1).</p>
<p style="margin-left:9%; margin-top: 1em">Note that it is
not safe to use <b>dlclose</b>(3) on a tracepoint provider
shared object that is being actively used for tracing, due
to a lack of reference counting from LTTng−UST to the
shared object.</p>
<p style="margin-left:9%; margin-top: 1em">For example,
statically linking a tracepoint provider to a shared object
which is to be dynamically loaded by an application (a
plugin, for example) is not safe: the shared object, which
contains the tracepoint provider, could be dynamically
closed (<b>dlclose</b>(3)) at any time by the
application.</p>
<p style="margin-left:9%; margin-top: 1em">To instrument a
shared object, either:</p>
<p style="margin-left:14%; margin-top: 1em">•
Statically link the tracepoint provider to the application,
or</p>
<p style="margin-left:14%; margin-top: 1em">• Build
the tracepoint provider as a shared object (following the
procedure shown in this section), and preload it when
tracing is needed using the <b>LD_PRELOAD</b> environment
variable.</p>
<h3>Using LTTng−UST with daemons
<a name="Using LTTng−UST with daemons"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em">Some extra care
is needed when using <b>liblttng-ust</b> with daemon
applications that call <b>fork</b>(2), <b>clone</b>(2), or
BSD’s <b>rfork</b>(2) without a following
<b>exec</b>(3) family system call. The library
<b>liblttng-ust-fork.so</b> needs to be preloaded before
starting the application with the <b>LD_PRELOAD</b>
environment variable (see <b>ld.so</b>(8)).</p>
<p style="margin-left:9%; margin-top: 1em">To use
<b>liblttng-ust</b> with a daemon application which closes
file descriptors that were not opened by it, preload the
<b>liblttng-ust-fd.so</b> library before you start the
application. Typical use cases include daemons closing all
file descriptors after <b>fork</b>(2), and buggy
applications doing “double−closes”.</p>
<h3>Context information
<a name="Context information"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em">Context
information can be prepended by the LTTng−UST tracer
before each event, or before specific events.</p>
<p style="margin-left:9%; margin-top: 1em">Context fields
can be added to specific channels using
<b>lttng-add-context</b>(1).</p>
<p style="margin-left:9%; margin-top: 1em">The following
context fields are supported by LTTng−UST:</p>
<p style="margin-left:9%; margin-top: 1em">General context
fields</p>
<p style="margin-left:14%; margin-top: 1em"><b>cpu_id</b></p>
<p style="margin-left:19%;">CPU ID.</p>
<p style="margin-left:24%; margin-top: 1em"><b><big>Note</big></b>
<br/>
This context field is always enabled, and it cannot be added
with <b>lttng-add-context</b>(1). Its main purpose is to be
used for dynamic event filtering. See
<b>lttng-enable-event</b>(1) for more information about
event filtering.</p>
<p style="margin-left:14%; margin-top: 1em"><b>ip</b></p>
<p style="margin-left:19%;">Instruction pointer: enables
recording the exact address from which an event was emitted.
This context field can be used to reverse−lookup the
source location that caused the event to be emitted.</p>
<p style="margin-left:14%; margin-top: 1em"><b>pthread_id</b></p>
<p style="margin-left:19%;">POSIX thread identifier.</p>
<p style="margin-left:19%; margin-top: 1em">Can be used on
architectures where <b>pthread_t</b> maps nicely to an
<b>unsigned long</b> type.</p>
<p style="margin-left:9%; margin-top: 1em">Process context
fields</p>
<p style="margin-left:14%; margin-top: 1em"><b>procname</b></p>
<p style="margin-left:19%;">Thread name, as set by
<b>exec</b>(3) or <b>prctl</b>(2). It is recommended that
programs set their thread name with <b>prctl</b>(2) before
hitting the first tracepoint for that thread.</p>
<p style="margin-left:14%; margin-top: 1em"><b>vpid</b></p>
<p style="margin-left:19%;">Virtual process ID: process ID
as seen from the point of view of the current process ID
namespace (see <b>pid_namespaces</b>(7)).</p>
<p style="margin-left:14%; margin-top: 1em"><b>vtid</b></p>
<p style="margin-left:19%;">Virtual thread ID: thread ID as
seen from the point of view of the current process ID
namespace (see <b>pid_namespaces</b>(7)).</p>
<p style="margin-left:9%; margin-top: 1em">perf context
fields</p>
<p style="margin-left:14%; margin-top: 1em"><b>perf:thread:COUNTER</b></p>
<p style="margin-left:19%;">perf counter named
<i>COUNTER</i>. Use <b>lttng add-context --list</b> to list
the available perf counters.</p>
<p style="margin-left:19%; margin-top: 1em">Only available
on IA−32 and x86−64 architectures.</p>
<p style="margin-left:14%; margin-top: 1em"><b>perf:thread:raw:rN:NAME</b></p>
<p style="margin-left:19%;">perf counter with raw ID
<i>N</i> and custom name <i>NAME</i>. See
<b>lttng-add-context</b>(1) for more details.</p>
<p style="margin-left:9%; margin-top: 1em">Namespace
context fields (see <b>namespaces</b>(7))</p>
<p style="margin-left:14%; margin-top: 1em"><b>cgroup_ns</b></p>
<p style="margin-left:19%;">Inode number of the current
control group namespace (see <b>cgroup_namespaces</b>(7)) in
the proc file system.</p>
<p style="margin-left:14%; margin-top: 1em"><b>ipc_ns</b></p>
<p style="margin-left:19%;">Inode number of the current IPC
namespace (see <b>ipc_namespaces</b>(7)) in the proc file
system.</p>
<p style="margin-left:14%; margin-top: 1em"><b>mnt_ns</b></p>
<p style="margin-left:19%;">Inode number of the current
mount point namespace (see <b>mount_namespaces</b>(7)) in
the proc file system.</p>
<p style="margin-left:14%; margin-top: 1em"><b>net_ns</b></p>
<p style="margin-left:19%;">Inode number of the current
network namespace (see <b>network_namespaces</b>(7)) in the
proc file system.</p>
<p style="margin-left:14%; margin-top: 1em"><b>pid_ns</b></p>
<p style="margin-left:19%;">Inode number of the current
process ID namespace (see <b>pid_namespaces</b>(7)) in the
proc file system.</p>
<p style="margin-left:14%; margin-top: 1em"><b>time_ns</b></p>
<p style="margin-left:19%;">Inode number of the current
clock namespace (see <b>time_namespaces</b>(7)) in the proc
file system.</p>
<p style="margin-left:14%; margin-top: 1em"><b>user_ns</b></p>
<p style="margin-left:19%;">Inode number of the current
user namespace (see <b>user_namespaces</b>(7)) in the proc
file system.</p>
<p style="margin-left:14%; margin-top: 1em"><b>uts_ns</b></p>
<p style="margin-left:19%;">Inode number of the current UTS
namespace (see <b>uts_namespaces</b>(7)) in the proc file
system.</p>
<p style="margin-left:9%; margin-top: 1em">Credential
context fields (see <b>credentials</b>(7))</p>
<p style="margin-left:14%; margin-top: 1em"><b>vuid</b></p>
<p style="margin-left:19%;">Virtual real user ID: real user
ID as seen from the point of view of the current user
namespace (see <b>user_namespaces</b>(7)).</p>
<p style="margin-left:14%; margin-top: 1em"><b>vgid</b></p>
<p style="margin-left:19%;">Virtual real group ID: real
group ID as seen from the point of view of the current user
namespace (see <b>user_namespaces</b>(7)).</p>
<p style="margin-left:14%; margin-top: 1em"><b>veuid</b></p>
<p style="margin-left:19%;">Virtual effective user ID:
effective user ID as seen from the point of view of the
current user namespace (see <b>user_namespaces</b>(7)).</p>
<p style="margin-left:14%; margin-top: 1em"><b>vegid</b></p>
<p style="margin-left:19%;">Virtual effective group ID:
effective group ID as seen from the point of view of the
current user namespace (see <b>user_namespaces</b>(7)).</p>
<p style="margin-left:14%; margin-top: 1em"><b>vsuid</b></p>
<p style="margin-left:19%;">Virtual saved set−user
ID: saved set−user ID as seen from the point of view
of the current user namespace (see
<b>user_namespaces</b>(7)).</p>
<p style="margin-left:14%; margin-top: 1em"><b>vsgid</b></p>
<p style="margin-left:19%;">Virtual saved set−group
ID: saved set−group ID as seen from the point of view
of the current user namespace (see
<b>user_namespaces</b>(7)).</p>
<h3>LTTng−UST state dump
<a name="LTTng−UST state dump"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em">If an
application that uses <b>liblttng-ust</b> becomes part of a
tracing session, information about its currently loaded
shared objects, their build IDs, and their debug link
information are emitted as events by the tracer.</p>
<p style="margin-left:9%; margin-top: 1em">The following
LTTng−UST state dump events exist and must be enabled
to record application state dumps. Note that, during the
state dump phase, LTTng−UST can also emit <i>shared
library load/unload</i> events (see <i>Shared library
load/unload tracking</i> below).</p>
<p style="margin-left:9%; margin-top: 1em"><b>lttng_ust_statedump:start</b></p>
<p style="margin-left:14%;">Emitted when the state dump
begins.</p>
<p style="margin-left:14%; margin-top: 1em">This event has
no fields.</p>
<p style="margin-left:9%; margin-top: 1em"><b>lttng_ust_statedump:end</b></p>
<p style="margin-left:14%;">Emitted when the state dump
ends. Once this event is emitted, it is guaranteed that, for
a given process, the state dump is complete.</p>
<p style="margin-left:14%; margin-top: 1em">This event has
no fields.</p>
<p style="margin-left:9%; margin-top: 1em"><b>lttng_ust_statedump:bin_info</b></p>
<p style="margin-left:14%;">Emitted when information about
a currently loaded executable or shared object is found.</p>
<p style="margin-left:14%; margin-top: 1em">Fields:</p>
<p style="margin-left:9%; margin-top: 1em"><b>lttng_ust_statedump:build_id</b></p>
<p style="margin-left:14%;">Emitted when a build ID is
found in a currently loaded shared library. See Debugging
Information in Separate Files
&lt;https://sourceware.org/gdb/onlinedocs/gdb/Separate-Debug-Files.html&gt;
for more information about build IDs.</p>
<p style="margin-left:14%; margin-top: 1em">Fields:</p>
<p style="margin-left:9%; margin-top: 1em"><b>lttng_ust_statedump:debug_link</b></p>
<p style="margin-left:14%;">Emitted when debug link
information is found in a currently loaded shared library.
See Debugging Information in Separate Files
&lt;https://sourceware.org/gdb/onlinedocs/gdb/Separate-Debug-Files.html&gt;
for more information about debug links.</p>
<p style="margin-left:14%; margin-top: 1em">Fields:</p>
<p style="margin-left:9%; margin-top: 1em"><b>lttng_ust_statedump:procname</b></p>
<p style="margin-left:14%;">The process procname at process
start.</p>
<p style="margin-left:14%; margin-top: 1em">Fields:</p>
<h3>Shared library load/unload tracking
<a name="Shared library load/unload tracking"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em">The
<i>LTTng−UST state dump</i> and the LTTng−UST
helper library to instrument the dynamic linker (see
<b>liblttng-ust-dl</b>(3)) can emit <b>shared library
load/unload tracking</b> events.</p>
<p style="margin-left:9%; margin-top: 1em">The following
shared library load/unload tracking events exist and must be
enabled to track the loading and unloading of shared
libraries:</p>
<p style="margin-left:9%; margin-top: 1em"><b>lttng_ust_lib:load</b></p>
<p style="margin-left:14%;">Emitted when a shared library
(shared object) is loaded.</p>
<p style="margin-left:14%; margin-top: 1em">Fields:</p>
<p style="margin-left:9%; margin-top: 1em"><b>lttng_ust_lib:unload</b></p>
<p style="margin-left:14%;">Emitted when a shared library
(shared object) is unloaded.</p>
<p style="margin-left:14%; margin-top: 1em">Fields:</p>
<p style="margin-left:9%; margin-top: 1em"><b>lttng_ust_lib:build_id</b></p>
<p style="margin-left:14%;">Emitted when a build ID is
found in a loaded shared library (shared object). See
Debugging Information in Separate Files
&lt;https://sourceware.org/gdb/onlinedocs/gdb/Separate-Debug-Files.html&gt;
for more information about build IDs.</p>
<p style="margin-left:14%; margin-top: 1em">Fields:</p>
<p style="margin-left:9%; margin-top: 1em"><b>lttng_ust_lib:debug_link</b></p>
<p style="margin-left:14%;">Emitted when debug link
information is found in a loaded shared library (shared
object). See Debugging Information in Separate Files
&lt;https://sourceware.org/gdb/onlinedocs/gdb/Separate-Debug-Files.html&gt;
for more information about debug links.</p>
<p style="margin-left:14%; margin-top: 1em">Fields:</p>
<h3>Detect if LTTng−UST is loaded
<a name="Detect if LTTng−UST is loaded"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em">To detect if
<b>liblttng-ust</b> is loaded from an application:</p>
<p style="margin-left:14%; margin-top: 1em">1. Define the
<b>lttng_ust_loaded</b> weak symbol globally:</p>
<p style="margin-left:19%; margin-top: 1em">int
lttng_ust_loaded __attribute__((weak));</p>
<p style="margin-left:14%; margin-top: 1em">This weak
symbol is set by the constructor of <b>liblttng-ust</b>.</p>
<p style="margin-left:14%; margin-top: 1em">2. Test
<b>lttng_ust_loaded</b> where needed:</p>
<p style="margin-left:19%; margin-top: 1em">/* ... */</p>
<p style="margin-left:19%; margin-top: 1em">if
(lttng_ust_loaded) { <br/>
/* LTTng−UST is loaded */ <br/>
} else { <br/>
/* LTTng−UST is NOT loaded */ <br/>
}</p>
<p style="margin-left:19%; margin-top: 1em">/* ... */</p>
<h2>EXAMPLE
<a name="EXAMPLE"></a>
</h2>
<p style="margin-left:14%; margin-top: 1em"><b><big>Note</big></b></p>
<p style="margin-left:14%; margin-top: 1em">A few examples
are available in the directory of LTTng−UST’s
source tree.</p>
<p style="margin-left:9%; margin-top: 1em">This example
shows all the features documented in the previous sections.
The <i>static linking</i> method is chosen here to link the
application with the tracepoint provider.</p>
<p style="margin-left:9%; margin-top: 1em">You can compile
the source files and link them together statically like
this:</p>
<p style="margin-left:14%; margin-top: 1em">$ cc −c
−I. tp.c <br/>
$ cc −c app.c <br/>
$ cc −o app tp.o app.o −llttng−ust
−ldl</p>
<p style="margin-left:9%; margin-top: 1em">Using the
<b>lttng</b>(1) tool, create an LTTng tracing session,
enable all the events of this tracepoint provider, and start
tracing:</p>
<p style="margin-left:14%; margin-top: 1em">$ lttng create
my−session <br/>
$ lttng enable−event −−userspace
'my_provider:*' <br/>
$ lttng start</p>
<p style="margin-left:9%; margin-top: 1em">You may also
enable specific events:</p>
<p style="margin-left:14%; margin-top: 1em">$ lttng
enable−event −−userspace
my_provider:big_event <br/>
$ lttng enable−event −−userspace
my_provider:event_instance2</p>
<p style="margin-left:9%; margin-top: 1em">Run the
application:</p>
<p style="margin-left:14%; margin-top: 1em">$ ./app some
arguments</p>
<p style="margin-left:9%; margin-top: 1em">Stop the current
tracing session and inspect the recorded events:</p>
<p style="margin-left:14%; margin-top: 1em">$ lttng stop
<br/>
$ lttng view</p>
<h3>Tracepoint provider header file
<a name="Tracepoint provider header file"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em"><b>tp.h</b>:</p>
<p style="margin-left:14%; margin-top: 1em">#undef
LTTNG_UST_TRACEPOINT_PROVIDER <br/>
#define LTTNG_UST_TRACEPOINT_PROVIDER my_provider</p>
<p style="margin-left:14%; margin-top: 1em">#undef
LTTNG_USTTRACEPOINT_INCLUDE <br/>
#define LTTNG_USTTRACEPOINT_INCLUDE "./tp.h"</p>
<p style="margin-left:14%; margin-top: 1em">#if
!defined(_TP_H) || \ <br/>
defined(LTTNG_UST_TRACEPOINT_HEADER_MULTI_READ) <br/>
#define _TP_H</p>
<p style="margin-left:14%; margin-top: 1em">#include
&lt;lttng/tracepoint.h&gt; <br/>
#include &lt;stdio.h&gt;</p>
<p style="margin-left:14%; margin-top: 1em">#include
"app.h"</p>
<p style="margin-left:14%; margin-top: 1em">LTTNG_UST_TRACEPOINT_EVENT(
<br/>
my_provider, <br/>
simple_event, <br/>
LTTNG_UST_TP_ARGS( <br/>
int, my_integer_arg, <br/>
const char *, my_string_arg <br/>
), <br/>
LTTNG_UST_TP_FIELDS( <br/>
lttng_ust_field_string(argc, my_string_arg) <br/>
lttng_ust_field_integer(int, argv, my_integer_arg) <br/>
) <br/>
)</p>
<p style="margin-left:14%; margin-top: 1em">LTTNG_UST_TRACEPOINT_ENUM(
<br/>
my_provider, <br/>
my_enum, <br/>
LTTNG_UST_TP_ENUM_VALUES( <br/>
lttng_ust_field_enum_value("ZERO", 0) <br/>
lttng_ust_field_enum_value("ONE", 1) <br/>
lttng_ust_field_enum_value("TWO", 2) <br/>
lttng_ust_field_enum_range("A RANGE", 52, 125)
<br/>
lttng_ust_field_enum_value("ONE THOUSAND", 1000)
<br/>
) <br/>
)</p>
<p style="margin-left:14%; margin-top: 1em">LTTNG_UST_TRACEPOINT_EVENT(
<br/>
my_provider, <br/>
big_event, <br/>
LTTNG_UST_TP_ARGS( <br/>
int, my_integer_arg, <br/>
const char *, my_string_arg, <br/>
FILE *, stream, <br/>
double, flt_arg, <br/>
int *, array_arg <br/>
), <br/>
LTTNG_UST_TP_FIELDS( <br/>
lttng_ust_field_integer(int, int_field1, my_integer_arg * 2)
<br/>
lttng_ust_field_integer_hex(long int, stream_pos, <br/>
ftell(stream)) <br/>
lttng_ust_field_float(double, float_field, flt_arg) <br/>
lttng_ust_field_string(string_field, my_string_arg) <br/>
lttng_ust_field_array(int, array_field, array_arg, 7) <br/>
lttng_ust_field_array_text(char, array_text_field, <br/>
array_arg, 5) <br/>
lttng_ust_field_sequence(int, seq_field, array_arg, unsigned
int, <br/>
my_integer_arg / 10) <br/>
lttng_ust_field_sequence_text(char, seq_text_field, <br/>
array_arg, unsigned int, <br/>
my_integer_arg / 5) <br/>
lttng_ust_field_enum(my_provider, my_enum, int, <br/>
enum_field, array_arg[1]) <br/>
) <br/>
)</p>
<p style="margin-left:14%; margin-top: 1em">LTTNG_UST_TRACEPOINT_LOGLEVEL(my_provider,
big_event, <br/>
LTTNG_UST_TRACEPOINT_LOGLEVEL_WARNING)</p>
<p style="margin-left:14%; margin-top: 1em">LTTNG_UST_TRACEPOINT_EVENT_CLASS(
<br/>
my_provider, <br/>
my_tracepoint_class, <br/>
LTTNG_UST_TP_ARGS( <br/>
int, my_integer_arg, <br/>
struct app_struct *, app_struct_arg <br/>
), <br/>
LTTNG_UST_TP_FIELDS( <br/>
lttng_ust_field_integer(int, a, my_integer_arg) <br/>
lttng_ust_field_integer(unsigned long, b,
app_struct_arg−&gt;b) <br/>
lttng_ust_field_string(c, app_struct_arg−&gt;c) <br/>
) <br/>
)</p>
<p style="margin-left:14%; margin-top: 1em">LTTNG_UST_TRACEPOINT_EVENT_INSTANCE(
<br/>
my_provider, <br/>
my_tracepoint_class, <br/>
my_provider, <br/>
event_instance1, <br/>
LTTNG_UST_TP_ARGS( <br/>
int, my_integer_arg, <br/>
struct app_struct *, app_struct_arg <br/>
) <br/>
)</p>
<p style="margin-left:14%; margin-top: 1em">LTTNG_UST_TRACEPOINT_EVENT_INSTANCE(
<br/>
my_provider, <br/>
my_tracepoint_class, <br/>
my_provider, <br/>
event_instance2, <br/>
LTTNG_UST_TP_ARGS( <br/>
int, my_integer_arg, <br/>
struct app_struct *, app_struct_arg <br/>
) <br/>
)</p>
<p style="margin-left:14%; margin-top: 1em">LTTNG_UST_TRACEPOINT_LOGLEVEL(my_provider,
event_instance2, <br/>
LTTNG_UST_TRACEPOINT_LOGLEVEL_INFO)</p>
<p style="margin-left:14%; margin-top: 1em">LTTNG_UST_TRACEPOINT_EVENT_INSTANCE(
<br/>
my_provider, <br/>
my_tracepoint_class, <br/>
my_provider, <br/>
event_instance3, <br/>
LTTNG_UST_TP_ARGS( <br/>
int, my_integer_arg, <br/>
struct app_struct *, app_struct_arg <br/>
) <br/>
)</p>
<p style="margin-left:14%; margin-top: 1em">#endif /* _TP_H
*/</p>
<p style="margin-left:14%; margin-top: 1em">#include
&lt;lttng/tracepoint−event.h&gt;</p>
<h3>Tracepoint provider source file
<a name="Tracepoint provider source file"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em"><b>tp.c</b>:</p>
<p style="margin-left:14%; margin-top: 1em">#define
LTTNG_UST_TRACEPOINT_CREATE_PROBES <br/>
#define LTTNG_UST_TRACEPOINT_DEFINE</p>
<p style="margin-left:14%; margin-top: 1em">#include
"tp.h"</p>
<h3>Application header file
<a name="Application header file"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em"><b>app.h</b>:</p>
<p style="margin-left:14%; margin-top: 1em">#ifndef _APP_H
<br/>
#define _APP_H</p>
<p style="margin-left:14%; margin-top: 1em">struct
app_struct { <br/>
unsigned long b; <br/>
const char *c; <br/>
double d; <br/>
};</p>
<p style="margin-left:14%; margin-top: 1em">#endif /*
_APP_H */</p>
<h3>Application source file
<a name="Application source file"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em"><b>app.c</b>:</p>
<p style="margin-left:14%; margin-top: 1em">#include
&lt;stdlib.h&gt; <br/>
#include &lt;stdio.h&gt;</p>
<p style="margin-left:14%; margin-top: 1em">#include
"tp.h" <br/>
#include "app.h"</p>
<p style="margin-left:14%; margin-top: 1em">static int
array_of_ints[] = { <br/>
100, −35, 1, 23, 14, −6, 28, 1001, −3000,
<br/>
};</p>
<p style="margin-left:14%; margin-top: 1em">int main(int
argc, char* argv[]) <br/>
{ <br/>
FILE *stream; <br/>
struct app_struct app_struct;</p>
<p style="margin-left:14%; margin-top: 1em">lttng_ust_tracepoint(my_provider,
simple_event, argc, argv[0]); <br/>
stream = fopen("/tmp/app.txt", "w");</p>
<p style="margin-left:14%; margin-top: 1em">if (!stream) {
<br/>
fprintf(stderr, <br/>
"Error: Cannot open /tmp/app.txt for writing\n");
<br/>
return EXIT_FAILURE; <br/>
}</p>
<p style="margin-left:14%; margin-top: 1em">if
(fprintf(stream, "0123456789") != 10) { <br/>
fclose(stream); <br/>
fprintf(stderr, "Error: Cannot write to
/tmp/app.txt\n"); <br/>
return EXIT_FAILURE; <br/>
}</p>
<p style="margin-left:14%; margin-top: 1em">lttng_ust_tracepoint(my_provider,
big_event, 35, <br/>
"hello tracepoint", stream, −3.14, <br/>
array_of_ints); <br/>
fclose(stream); <br/>
app_struct.b = argc; <br/>
app_struct.c = "[the string]"; <br/>
lttng_ust_tracepoint(my_provider, event_instance1, 23, <br/>
&amp;app_struct); <br/>
app_struct.b = argc * 5; <br/>
app_struct.c = "[other string]"; <br/>
lttng_ust_tracepoint(my_provider, event_instance2, 17, <br/>
&amp;app_struct); <br/>
app_struct.b = 23; <br/>
app_struct.c = "nothing"; <br/>
lttng_ust_tracepoint(my_provider, event_instance3,
−52, <br/>
&amp;app_struct); <br/>
return EXIT_SUCCESS; <br/>
}</p>
<h2>ENVIRONMENT VARIABLES
<a name="ENVIRONMENT VARIABLES"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_HOME</b></p>
<p style="margin-left:14%;">Alternative user’s home
directory. This variable is useful when the user running the
instrumented application has a non−writable home
directory.</p>
<p style="margin-left:14%; margin-top: 1em">Unix sockets
used for the communication between <b>liblttng-ust</b> and
the LTTng session and consumer daemons (part of the
LTTng−tools project) are located in a specific
directory under <b>$LTTNG_HOME</b> (or <b>$HOME</b> if
<b>$LTTNG_HOME</b> is not set).</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_ALLOW_BLOCKING</b></p>
<p style="margin-left:14%;">If set, allow the application
to retry event tracing when there’s no space left for
the event record in the sub−buffer, therefore
effectively blocking the application until space is made
available or the configured timeout is reached.</p>
<p style="margin-left:14%; margin-top: 1em">To allow an
application to block during tracing, you also need to
specify a blocking timeout when you create a channel with
the <b>--blocking-timeout</b> option of the
<b>lttng-enable-channel</b>(1) command.</p>
<p style="margin-left:14%; margin-top: 1em">This option can
be useful in workloads generating very large trace data
throughput, where blocking the application is an acceptable
trade−off to prevent discarding event records.</p>
<p style="margin-left:19%; margin-top: 1em"><b><big>Warning</big></b>
<br/>
Setting this environment variable may significantly affect
application timings.</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_ABORT_ON_CRITICAL</b></p>
<p style="margin-left:14%;">If set, abort the instrumented
application on a critical error message.</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_CLOCK_PLUGIN</b></p>
<p style="margin-left:14%;">Path to the shared object which
acts as the clock override plugin. An example of such a
plugin can be found in the LTTng−UST documentation
under</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_DEBUG</b></p>
<p style="margin-left:14%;">If set, enable
<b>liblttng-ust</b>'s debug and error output.</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_GETCPU_PLUGIN</b></p>
<p style="margin-left:14%;">Path to the shared object which
acts as the <b>getcpu()</b> override plugin. An example of
such a plugin can be found in the LTTng−UST
documentation under</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_REGISTER_TIMEOUT</b></p>
<p style="margin-left:14%;">Waiting time for the
<i>registration done</i> session daemon command before
proceeding to execute the main program (milliseconds).</p>
<p style="margin-left:14%; margin-top: 1em">The value
<b>0</b> means <i>do not wait</i>. The value <b>-1</b> means
<i>wait forever</i>. Setting this environment variable to
<b>0</b> is recommended for applications with time
constraints on the process startup time.</p>
<p style="margin-left:14%; margin-top: 1em">Default:
3000.</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_WITHOUT_BADDR_STATEDUMP</b></p>
<p style="margin-left:14%;">If set, prevents
<b>liblttng-ust</b> from performing a base address state
dump (see the <i>LTTng−UST state dump</i> section
above).</p>
<p style="margin-left:9%; margin-top: 1em"><b>LTTNG_UST_WITHOUT_PROCNAME_STATEDUMP</b></p>
<p style="margin-left:14%;">If set, prevents
<b>liblttng-ust</b> from performing a procname state dump
(see the <i>LTTng−UST state dump</i> section
above).</p>
<h2>BUGS
<a name="BUGS"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">If you encounter
any issue or usability problem, please report it on the
LTTng bug tracker
&lt;https://bugs.lttng.org/projects/lttng-ust&gt;.</p>
<h2>RESOURCES
<a name="RESOURCES"></a>
</h2>
<p style="margin-left:14%; margin-top: 1em">• LTTng
project website &lt;http://lttng.org&gt;</p>
<p style="margin-left:14%; margin-top: 1em">• LTTng
documentation &lt;http://lttng.org/docs&gt;</p>
<p style="margin-left:14%; margin-top: 1em">• Git
repositories &lt;http://git.lttng.org&gt;</p>
<p style="margin-left:14%; margin-top: 1em">• GitHub
organization &lt;http://github.com/lttng&gt;</p>
<p style="margin-left:14%; margin-top: 1em">•
Continuous integration &lt;http://ci.lttng.org/&gt;</p>
<p style="margin-left:14%; margin-top: 1em">• Mailing
list &lt;http://lists.lttng.org&gt; for support and
development: <b>lttng-dev@lists.lttng.org</b></p>
<p style="margin-left:14%; margin-top: 1em">• IRC
channel &lt;irc://irc.oftc.net/lttng&gt;: <b>#lttng</b> on
<b>irc.oftc.net</b></p>
<h2>COPYRIGHTS
<a name="COPYRIGHTS"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">This library is
part of the LTTng−UST project.</p>
<p style="margin-left:9%; margin-top: 1em">This library is
distributed under the GNU Lesser General Public License,
version 2.1
&lt;http://www.gnu.org/licenses/old-licenses/lgpl-2.1.en.html&gt;.
See the for more details.</p>
<h2>THANKS
<a name="THANKS"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">Thanks to
Ericsson for funding this work, providing real−life
use cases, and testing.</p>
<p style="margin-left:9%; margin-top: 1em">Special thanks
to Michel Dagenais and the DORSAL laboratory
&lt;http://www.dorsal.polymtl.ca/&gt; at École
Polytechnique de Montréal for the LTTng journey.</p>
<h2>AUTHORS
<a name="AUTHORS"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">LTTng−UST
was originally written by Mathieu Desnoyers, with additional
contributions from various other people. It is currently
maintained by Mathieu Desnoyers
&lt;mailto:mathieu.desnoyers@efficios.com&gt;.</p>
<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>lttng_ust_tracef</b>(3),
<b>lttng_ust_tracelog</b>(3), <b>lttng-gen-tp</b>(1),
<b>lttng-ust-dl</b>(3), <b>lttng-ust-cyg-profile</b>(3),
<b>lttng</b>(1), <b>lttng-enable-event</b>(1),
<b>lttng-list</b>(1), <b>lttng-add-context</b>(1),
<b>babeltrace</b>(1), <b>dlopen</b>(3), <b>ld.so</b>(8)</p>
<hr/>
</body>
</html>
