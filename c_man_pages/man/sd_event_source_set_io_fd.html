<!-- Creator     : groff version 1.23.0 -->
<!-- CreationDate: Sat Apr  5 20:48:50 2025 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">

<html>
<head>
<meta content="groff -Thtml, see www.gnu.org" name="generator"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="text/css" name="Content-Style"/>
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>SD_EVENT_ADD_IO</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><style>
            :root {
                --primary-color: #3498db;
                --background-color: #f9f9f9;
                --text-color: #333;
                --code-bg: #f0f0f0;
                --header-color: #2c3e50;
                --link-color: #2980b9;
            }
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                line-height: 1.6;
                color: var(--text-color);
                background-color: var(--background-color);
                max-width: 900px;
                margin: 0 auto;
                padding: 2rem;
            }
            h1, h2, h3, h4 {
                color: var(--header-color);
            }
            h1 {
                border-bottom: 2px solid var(--primary-color);
                padding-bottom: 0.5rem;
            }
            pre {
                background-color: var(--code-bg);
                padding: 1rem;
                border-radius: 4px;
                overflow-x: auto;
            }
            a {
                color: var(--link-color);
                text-decoration: none;
            }
            a:hover {
                text-decoration: underline;
            }
            .man-navigation {
                background-color: #fff;
                border-bottom: 1px solid #ddd;
                padding: 0.5rem 0;
                position: sticky;
                top: 0;
                z-index: 100;
            }
            .section {
                margin-top: 2rem;
            }
            @media (prefers-color-scheme: dark) {
                :root {
                    --primary-color: #3498db;
                    --background-color: #222;
                    --text-color: #f0f0f0;
                    --code-bg: #333;
                    --header-color: #3498db;
                    --link-color: #5dade2;
                }
            }
            .back-to-index {
                display: inline-block;
                margin: 1rem 0;
                padding: 0.5rem 1rem;
                background-color: var(--primary-color);
                color: white;
                border-radius: 4px;
                text-decoration: none;
            }
            .back-to-index:hover {
                background-color: var(--link-color);
                text-decoration: none;
            }
        </style></head>
<body><div><a class="back-to-index" href="../index.html">← Back to Index</a></div>
<h1 align="center">SD_EVENT_ADD_IO</h1>
<a href="#NAME">NAME</a><br/>
<a href="#SYNOPSIS">SYNOPSIS</a><br/>
<a href="#DESCRIPTION">DESCRIPTION</a><br/>
<a href="#RETURN VALUE">RETURN VALUE</a><br/>
<a href="#Errors">Errors</a><br/>
<a href="#NOTES">NOTES</a><br/>
<a href="#HISTORY">HISTORY</a><br/>
<a href="#SEE ALSO">SEE ALSO</a><br/>
<hr/>
<h2>NAME
<a name="NAME"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">sd_event_add_io,
sd_event_source_get_io_events,
sd_event_source_set_io_events,
sd_event_source_get_io_revents, sd_event_source_get_io_fd,
sd_event_source_set_io_fd, sd_event_source_get_io_fd_own,
sd_event_source_set_io_fd_own, sd_event_source,
sd_event_io_handler_t − Add an I/O event source to an
event loop</p>
<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>#include
&lt;systemd/sd−event.h&gt;</b></p>
<p style="margin-left:9%; margin-top: 1em"><b>typedef
struct sd_event_source sd_event_source;</b></p>
<table border="0" cellpadding="0" cellspacing="0" frame="void" rules="none" width="100%">
<tr align="left" valign="top">
<td width="9%"></td>
<td width="91%">
<p style="margin-top: 1em"><b>typedef int
(*sd_event_io_handler_t)(sd_event_source *</b><i>s</i><b>,
int </b><i>fd</i><b>,
uint32_t </b><i>revents</i><b>,
void *</b><i>userdata</i><b>);</b></p> </td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="91%">
<p style="margin-top: 1em"><b>int
sd_event_add_io(sd_event *</b><i>event</i><b>,
sd_event_source **</b><i>source</i><b>,
int </b><i>fd</i><b>,
uint32_t </b><i>events</i><b>,
sd_event_io_handler_t </b><i>handler</i><b>,
void *</b><i>userdata</i><b>);</b></p> </td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="91%">
<p style="margin-top: 1em"><b>int
sd_event_source_get_io_events(sd_event_source *</b><i>source</i><b>,
uint32_t *</b><i>events</i><b>);</b></p> </td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="91%">
<p style="margin-top: 1em"><b>int
sd_event_source_set_io_events(sd_event_source *</b><i>source</i><b>,
uint32_t </b><i>events</i><b>);</b></p> </td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="91%">
<p style="margin-top: 1em"><b>int
sd_event_source_get_io_revents(sd_event_source *</b><i>source</i><b>,
uint32_t *</b><i>revents</i><b>);</b></p> </td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="91%">
<p style="margin-top: 1em"><b>int
sd_event_source_get_io_fd(sd_event_source *</b><i>source</i><b>);</b></p> </td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="91%">
<p style="margin-top: 1em"><b>int
sd_event_source_set_io_fd(sd_event_source *</b><i>source</i><b>,
int </b><i>fd</i><b>);</b></p> </td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="91%">
<p style="margin-top: 1em"><b>int
sd_event_source_get_io_fd_own(sd_event_source *</b><i>source</i><b>);</b></p> </td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="91%">
<p style="margin-top: 1em"><b>int
sd_event_source_set_io_fd_own(sd_event_source *</b><i>source</i><b>,
int </b><i>b</i><b>);</b></p> </td></tr>
</table>
<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>sd_event_add_io()</b>
adds a new I/O event source to an event loop. The event loop
object is specified in the <i>event</i> parameter, the event
source object is returned in the <i>source</i> parameter.
The <i>fd</i> parameter takes the UNIX file descriptor to
watch, which may refer to a socket, a FIFO, a message queue,
a serial connection, a character device, or any other file
descriptor compatible with Linux <b>epoll</b>(7). The
<i>events</i> parameter takes a bit mask of events to watch
for, a combination of the following event flags:
<b>EPOLLIN</b>, <b>EPOLLOUT</b>, <b>EPOLLRDHUP</b>,
<b>EPOLLPRI</b>, and <b>EPOLLET</b>, see <b>epoll_ctl</b>(2)
for details. Note that not all file descriptors are
compatible with epoll, for example regular file or
directories are not. If this function is called with a file
descriptor that does not support epoll, <b>−EPERM</b>
is returned (also see below). In most cases such file
descriptors may be treated as always−readable or
always−writable, so that IO event watching is
unnecessary.</p>
<p style="margin-left:9%; margin-top: 1em">The
<i>handler</i> is a function to call when the event source
is triggered or <b>NULL</b>. The <i>userdata</i> pointer
will be passed to the handler function, and may be chosen
freely by the caller. The handler will also be passed the
file descriptor the event was seen on, as well as the actual
event flags. It's generally a subset of the events watched,
however may additionally include <b>EPOLLERR</b> and
<b>EPOLLHUP</b>. The handler may return negative to signal
an error (see below), other return values are ignored. If
<i>handler</i> is <b>NULL</b>, a default handler that calls
<b>sd_event_exit</b>(3) will be used.</p>
<p style="margin-left:9%; margin-top: 1em">By default, an
event source will stay enabled continuously
(<b>SD_EVENT_ON</b>), but this may be changed with
<b>sd_event_source_set_enabled</b>(3). If the handler
function returns a negative error code, it will either be
disabled after the invocation, even if the
<b>SD_EVENT_ON</b> mode was requested before, or it will
cause the loop to terminate, see
<b>sd_event_source_set_exit_on_failure</b>(3). Note that an
event source set to <b>SD_EVENT_ON</b> will fire
continuously unless data is read from or written to the file
descriptor to reset the mask of events seen.</p>
<p style="margin-left:9%; margin-top: 1em">Setting the I/O
event mask to watch for to 0 does not mean that the event
source won't be triggered anymore, as <b>EPOLLHUP</b> and
<b>EPOLLERR</b> may be triggered even with a zero event
mask. To temporarily disable an I/O event source use
<b>sd_event_source_set_enabled</b>(3) with
<b>SD_EVENT_OFF</b> instead.</p>
<p style="margin-left:9%; margin-top: 1em">To destroy an
event source object use <b>sd_event_source_unref</b>(3), but
note that the event source is only removed from the event
loop when all references to the event source are dropped. To
make sure an event source does not fire anymore, even if it
is still referenced, disable the event source using
<b>sd_event_source_set_enabled</b>(3) with
<b>SD_EVENT_OFF</b>.</p>
<p style="margin-left:9%; margin-top: 1em">If the second
parameter of <b>sd_event_add_io()</b> is <b>NULL</b> no
reference to the event source object is returned. In this
case the event source is considered "floating",
and will be destroyed implicitly when the event loop itself
is destroyed.</p>
<p style="margin-left:9%; margin-top: 1em">If the
<i>handler</i> to <b>sd_event_add_io()</b> is <b>NULL</b>,
and the event source fires, this will be considered a
request to exit the event loop. In this case, the
<i>userdata</i> parameter, cast to an integer, is passed as
the exit code parameter to <b>sd_event_exit</b>(3).</p>
<p style="margin-left:9%; margin-top: 1em">Note that this
call does not take possession of the file descriptor passed
in, ownership (and thus the duty to close it when it is no
longer needed) remains with the caller. However, with the
<b>sd_event_source_set_io_fd_own()</b> call (see below) the
event source may optionally take ownership of the file
descriptor after the event source has been created. In that
case the file descriptor is closed automatically as soon as
the event source is released.</p>
<p style="margin-left:9%; margin-top: 1em">It is
recommended to use <b>sd_event_add_io()</b> only in
conjunction with file descriptors that have
<b>O_NONBLOCK</b> set, to ensure that all I/O operations
from invoked handlers are properly asynchronous and
non−blocking. Using file descriptors without
<b>O_NONBLOCK</b> might result in unexpected starvation of
other event sources. See <b>fcntl</b>(2) for details on
enabling <b>O_NONBLOCK</b> mode.</p>
<p style="margin-left:9%; margin-top: 1em"><b>sd_event_source_get_io_events()</b>
retrieves the configured mask of watched I/O events of an
event source created previously with
<b>sd_event_add_io()</b>. It takes the event source object
and a pointer to a variable to store the mask in.</p>
<p style="margin-left:9%; margin-top: 1em"><b>sd_event_source_set_io_events()</b>
configures the mask of watched I/O events of an event source
created previously with <b>sd_event_add_io()</b>. It takes
the event source object and the new event mask.</p>
<p style="margin-left:9%; margin-top: 1em"><b>sd_event_source_get_io_revents()</b>
retrieves the I/O event mask of currently seen but
undispatched events from an event source created previously
with <b>sd_event_add_io()</b>. It takes the event source
object and a pointer to a variable to store the event mask
in. When called from a handler function on the handler's
event source object this will return the same mask as passed
to the handler's <i>revents</i> parameter. This call is
primarily useful to check for undispatched events of an
event source from the handler of an unrelated (possibly
higher priority) event source. Note the relation between
<b>sd_event_source_get_pending()</b> and
<b>sd_event_source_get_io_revents()</b>: both functions will
report non−zero results when there's an event pending
for the event source, but the former applies to all event
source types, the latter only to I/O event sources.</p>
<p style="margin-left:9%; margin-top: 1em"><b>sd_event_source_get_io_fd()</b>
retrieves the UNIX file descriptor of an event source
created previously with <b>sd_event_add_io()</b>. It takes
the event source object and returns the non−negative
file descriptor or a negative error number on error (see
below).</p>
<p style="margin-left:9%; margin-top: 1em"><b>sd_event_source_set_io_fd()</b>
changes the UNIX file descriptor of an I/O event source
created previously with <b>sd_event_add_io()</b>. It takes
the event source object and the new file descriptor as
parameters. If the event source owned the previous file
descriptor, that is if
<b>sd_event_source_set_io_fd_own()</b> had been called for
the event source with a non−zero value, then the
previous file descriptor will be closed and the event source
will also take the ownership of the new file descriptor on
success.</p>
<p style="margin-left:9%; margin-top: 1em"><b>sd_event_source_set_io_fd_own()</b>
controls whether the file descriptor of the event source
shall take ownership of the file descriptor. Takes a boolean
parameter <i>b</i>. When true (nonzero), the file descriptor
will be closed automatically when the event source is freed
or when the file descriptor is replaced by
<b>sd_event_source_set_io_fd()</b>. By default the
descriptor is not owned by the event source, and the
application has to do close it on its own if needed.</p>
<p style="margin-left:9%; margin-top: 1em"><b>sd_event_source_get_io_fd_own()</b>
may be used to query the current setting of the file
descriptor ownership boolean flag as set with
<b>sd_event_source_set_io_fd_own()</b>. It returns positive
if the file descriptor is closed automatically when the
event source is destroyed, zero if not, and negative on
error.</p>
<h2>RETURN VALUE
<a name="RETURN VALUE"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">On success,
these functions return 0 or a positive integer. On failure,
they return a negative errno−style error code.</p>
<h3>Errors
<a name="Errors"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em">Returned values
may indicate the following problems:</p>
<p style="margin-left:9%; margin-top: 1em"><b>−ENOMEM</b></p>
<p style="margin-left:14%;">Not enough memory to allocate
an object.</p>
<p style="margin-left:9%; margin-top: 1em"><b>−EINVAL</b></p>
<p style="margin-left:14%;">An invalid argument has been
passed.</p>
<p style="margin-left:9%; margin-top: 1em"><b>−ESTALE</b></p>
<p style="margin-left:14%;">The event loop is already
terminated.</p>
<p style="margin-left:9%; margin-top: 1em"><b>−ECHILD</b></p>
<p style="margin-left:14%;">The event loop has been created
in a different process, library or module instance.</p>
<p style="margin-left:9%; margin-top: 1em"><b>−EDOM</b></p>
<p style="margin-left:14%;">The passed event source is not
an I/O event source.</p>
<p style="margin-left:9%; margin-top: 1em"><b>−EPERM</b></p>
<p style="margin-left:14%;">The passed file descriptor does
not support the <b>epoll</b>(7) API, for example because it
is a regular file or directory. See <b>epoll_ctl</b>(2) for
details.</p>
<p style="margin-left:14%; margin-top: 1em">Added in
version 255.</p>
<h2>NOTES
<a name="NOTES"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">Functions
described here are available as a shared library, which can
be compiled against and linked to with the
<b>libsystemd pkg-config</b>(1) file.</p>
<p style="margin-left:9%; margin-top: 1em">The code
described here uses <b>getenv</b>(3), which is declared to
be not multi−thread−safe. This means that the
code calling the functions described here must not call
<b>setenv</b>(3) from a parallel thread. It is recommended
to only do calls to <b>setenv()</b> from an early phase of
the program when no other threads have been started.</p>
<h2>HISTORY
<a name="HISTORY"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>sd_event_io_handler_t()</b>,
<b>sd_event_add_io()</b>,
<b>sd_event_source_get_io_events()</b>,
<b>sd_event_source_set_io_events()</b>,
<b>sd_event_source_get_io_revents()</b>,
<b>sd_event_source_get_io_fd()</b>, and
<b>sd_event_source_set_io_fd()</b> were added in version
229.</p>
<p style="margin-left:9%; margin-top: 1em"><b>sd_event_source_get_io_fd_own()</b>
and <b>sd_event_source_set_io_fd_own()</b> were added in
version 239.</p>
<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>systemd</b>(1),
<b>sd-event</b>(3), <b>sd_event_new</b>(3),
<b>sd_event_now</b>(3), <b>sd_event_add_time</b>(3),
<b>sd_event_add_signal</b>(3), <b>sd_event_add_child</b>(3),
<b>sd_event_add_inotify</b>(3),
<b>sd_event_add_defer</b>(3),
<b>sd_event_source_set_enabled</b>(3),
<b>sd_event_source_set_priority</b>(3),
<b>sd_event_source_set_userdata</b>(3),
<b>sd_event_source_set_description</b>(3),
<b>sd_event_source_get_pending</b>(3),
<b>sd_event_source_set_floating</b>(3), <b>epoll_ctl</b>(2),
<b>epoll</b>(7)</p>
<hr/>
</body>
</html>
