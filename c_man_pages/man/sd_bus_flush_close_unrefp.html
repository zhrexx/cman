<!-- Creator     : groff version 1.23.0 -->
<!-- CreationDate: Sat Apr  5 19:50:46 2025 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">

<html>
<head>
<meta content="groff -Thtml, see www.gnu.org" name="generator"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="text/css" name="Content-Style"/>
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>SD_BUS_NEW</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><style>
            :root {
                --primary-color: #3498db;
                --background-color: #f9f9f9;
                --text-color: #333;
                --code-bg: #f0f0f0;
                --header-color: #2c3e50;
                --link-color: #2980b9;
            }
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                line-height: 1.6;
                color: var(--text-color);
                background-color: var(--background-color);
                max-width: 900px;
                margin: 0 auto;
                padding: 2rem;
            }
            h1, h2, h3, h4 {
                color: var(--header-color);
            }
            h1 {
                border-bottom: 2px solid var(--primary-color);
                padding-bottom: 0.5rem;
            }
            pre {
                background-color: var(--code-bg);
                padding: 1rem;
                border-radius: 4px;
                overflow-x: auto;
            }
            a {
                color: var(--link-color);
                text-decoration: none;
            }
            a:hover {
                text-decoration: underline;
            }
            .man-navigation {
                background-color: #fff;
                border-bottom: 1px solid #ddd;
                padding: 0.5rem 0;
                position: sticky;
                top: 0;
                z-index: 100;
            }
            .section {
                margin-top: 2rem;
            }
            @media (prefers-color-scheme: dark) {
                :root {
                    --primary-color: #3498db;
                    --background-color: #222;
                    --text-color: #f0f0f0;
                    --code-bg: #333;
                    --header-color: #3498db;
                    --link-color: #5dade2;
                }
            }
            .back-to-index {
                display: inline-block;
                margin: 1rem 0;
                padding: 0.5rem 1rem;
                background-color: var(--primary-color);
                color: white;
                border-radius: 4px;
                text-decoration: none;
            }
            .back-to-index:hover {
                background-color: var(--link-color);
                text-decoration: none;
            }
        </style></head>
<body><div><a class="back-to-index" href="../index.html">← Back to Index</a></div>
<h1 align="center">SD_BUS_NEW</h1>
<a href="#NAME">NAME</a><br/>
<a href="#SYNOPSIS">SYNOPSIS</a><br/>
<a href="#DESCRIPTION">DESCRIPTION</a><br/>
<a href="#RETURN VALUE">RETURN VALUE</a><br/>
<a href="#Errors">Errors</a><br/>
<a href="#NOTES">NOTES</a><br/>
<a href="#HISTORY">HISTORY</a><br/>
<a href="#SEE ALSO">SEE ALSO</a><br/>
<a href="#NOTES">NOTES</a><br/>
<hr/>
<h2>NAME
<a name="NAME"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">sd_bus_new,
sd_bus_ref, sd_bus_unref, sd_bus_unrefp, sd_bus_close_unref,
sd_bus_close_unrefp, sd_bus_flush_close_unref,
sd_bus_flush_close_unrefp − Create a new bus object
and create or destroy references to it</p>
<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>#include
&lt;systemd/sd−bus.h&gt;</b></p>
<table border="0" cellpadding="0" cellspacing="0" frame="void" rules="none" width="100%">
<tr align="left" valign="top">
<td width="9%"></td>
<td width="59%">
<p style="margin-top: 1em"><b>int
sd_bus_new(sd_bus **</b><i>bus</i><b>);</b></p> </td>
<td width="32%">
</td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="59%">
<p style="margin-top: 1em"><b>sd_bus
*sd_bus_ref(sd_bus *</b><i>bus</i><b>);</b></p> </td>
<td width="32%">
</td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="59%">
<p style="margin-top: 1em"><b>sd_bus
*sd_bus_unref(sd_bus *</b><i>bus</i><b>);</b></p> </td>
<td width="32%">
</td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="59%">
<p style="margin-top: 1em"><b>sd_bus
*sd_bus_close_unref(sd_bus *</b><i>bus</i><b>);</b></p> </td>
<td width="32%">
</td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="59%">
<p style="margin-top: 1em"><b>sd_bus
*sd_bus_flush_close_unref(sd_bus *</b><i>bus</i><b>);</b></p> </td>
<td width="32%">
</td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="59%">
<p style="margin-top: 1em"><b>void
sd_bus_unrefp(sd_bus **</b><i>busp</i><b>);</b></p> </td>
<td width="32%">
</td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="59%">
<p style="margin-top: 1em"><b>void
sd_bus_close_unrefp(sd_bus **</b><i>busp</i><b>);</b></p> </td>
<td width="32%">
</td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="59%">
<p style="margin-top: 1em"><b>void
sd_bus_flush_close_unrefp(sd_bus **</b><i>busp</i><b>);</b></p> </td>
<td width="32%">
</td></tr>
</table>
<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>sd_bus_new()</b>
creates a new bus object. This object is
reference−counted, and will be destroyed when all
references are gone. Initially, the caller of this function
owns the sole reference and the bus object will not be
connected to any bus. To connect it to a bus, make sure to
set an address with <b>sd_bus_set_address</b>(3) or a
related call, and then start the connection with
<b>sd_bus_start</b>(3).</p>
<p style="margin-left:9%; margin-top: 1em">In most cases,
it is better to use <b>sd_bus_default_user</b>(3),
<b>sd_bus_default_system</b>(3) or related calls instead of
the more low−level <b>sd_bus_new()</b> and
<b>sd_bus_start()</b>. The higher−level functions not
only allocate a bus object but also start the connection to
a well−known bus in a single function call.</p>
<p style="margin-left:9%; margin-top: 1em"><b>sd_bus_ref()</b>
increases the reference counter of <i>bus</i> by one.</p>
<p style="margin-left:9%; margin-top: 1em"><b>sd_bus_unref()</b>
decreases the reference counter of <i>bus</i> by one. Once
the reference count has dropped to zero, <i>bus</i> is
destroyed and cannot be used anymore, so further calls to
<b>sd_bus_ref()</b> or <b>sd_bus_unref()</b> are
illegal.</p>
<p style="margin-left:9%; margin-top: 1em"><b>sd_bus_unrefp()</b>
is similar to <b>sd_bus_unref()</b> but takes a pointer to a
pointer to an <b>sd_bus</b> object. This call is useful in
conjunction with GCC's and LLVM's
<b><font color="#0000FF">Clean−up Variable
Attribute</font></b>
<small><font color="#000000">[1]</font></small>
<font color="#000000">. Note that this function is defined
as an inline function. Use a declaration like the following,
in order to allocate a bus object that is freed
automatically as the code block is left:</font></p>
<p style="margin-left:14%; margin-top: 1em"><font color="#000000">{
<br/>
__attribute__((cleanup(sd_bus_unrefp))) sd_bus *bus = NULL;
<br/>
int r; <br/>
... <br/>
r = sd_bus_default(&amp;bus); <br/>
if (r &lt; 0) { <br/>
errno = −r; <br/>
fprintf(stderr, "Failed to allocate bus: %m\n");
<br/>
} <br/>
... <br/>
}</font></p>
<p style="margin-left:9%; margin-top: 1em"><font color="#000000"><b>sd_bus_ref()</b>
and <b>sd_bus_unref()</b> execute no operation if the
argument is <b>NULL</b>. <b>sd_bus_unrefp()</b> will first
dereference its argument, which must not be <b>NULL</b>, and
will execute no operation if <i>that</i> is
<b>NULL</b>.</font></p>
<p style="margin-left:9%; margin-top: 1em"><font color="#000000"><b>sd_bus_close_unref()</b>
is similar to <b>sd_bus_unref()</b>, but first executes
<b>sd_bus_close</b>(3), ensuring that the connection is
terminated before the reference to the connection is dropped
and possibly the object freed.</font></p>
<p style="margin-left:9%; margin-top: 1em"><font color="#000000"><b>sd_bus_flush_close_unref()</b>
is similar to <b>sd_bus_unref()</b>, but first executes
<b>sd_bus_flush</b>(3) as well as <b>sd_bus_close</b>(3),
ensuring that any pending messages are synchronously flushed
out before the reference to the connection is dropped and
possibly the object freed. This call is particularly useful
immediately before exiting from a program as it ensures that
any pending outgoing messages are written out, and
unprocessed but queued incoming messages released before the
connection is terminated and released.</font></p>
<p style="margin-left:9%; margin-top: 1em"><font color="#000000"><b>sd_bus_close_unrefp()</b>
is similar to <b>sd_bus_close_unref()</b>, but may be used
in GCC's and LLVM's Clean−up Variable Attribute, see
above. Similarly, <b>sd_bus_flush_close_unrefp()</b> is
similar to <b>sd_bus_flush_close_unref()</b>.</font></p>
<h2>RETURN VALUE
<a name="RETURN VALUE"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><font color="#000000">On
success, <b>sd_bus_new()</b> returns 0 or a positive
integer. On failure, it returns a negative errno−style
error code.</font></p>
<p style="margin-left:9%; margin-top: 1em"><font color="#000000"><b>sd_bus_ref()</b>
always returns the argument.</font></p>
<p style="margin-left:9%; margin-top: 1em"><font color="#000000"><b>sd_bus_unref()</b>
and <b>sd_bus_flush_close_unref()</b> always return
<b>NULL</b>.</font></p>
<h3>Errors
<a name="Errors"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em"><font color="#000000">Returned
errors may indicate the following problems:</font></p>
<p style="margin-left:9%; margin-top: 1em"><font color="#000000"><b>−ENOMEM</b></font></p>
<p style="margin-left:14%;"><font color="#000000">Memory
allocation failed.</font></p>
<h2>NOTES
<a name="NOTES"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><font color="#000000">Functions
described here are available as a shared library, which can
be compiled against and linked to with the
<b>libsystemd pkg-config</b>(1) file.</font></p>
<p style="margin-left:9%; margin-top: 1em"><font color="#000000">The
code described here uses <b>getenv</b>(3), which is declared
to be not multi−thread−safe. This means that the
code calling the functions described here must not call
<b>setenv</b>(3) from a parallel thread. It is recommended
to only do calls to <b>setenv()</b> from an early phase of
the program when no other threads have been
started.</font></p>
<h2>HISTORY
<a name="HISTORY"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><font color="#000000"><b>sd_bus_new()</b>,
<b>sd_bus_ref()</b>, and <b>sd_bus_unref()</b> were added in
version 209.</font></p>
<p style="margin-left:9%; margin-top: 1em"><font color="#000000"><b>sd_bus_unrefp()</b>
was added in version 229.</font></p>
<p style="margin-left:9%; margin-top: 1em"><font color="#000000"><b>sd_bus_flush_close_unref()</b>
and <b>sd_bus_flush_close_unrefp()</b> were added in version
240.</font></p>
<p style="margin-left:9%; margin-top: 1em"><font color="#000000"><b>sd_bus_close_unref()</b>
and <b>sd_bus_close_unrefp()</b> were added in version
241.</font></p>
<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><font color="#000000"><b>systemd</b>(1),
<b>sd-bus</b>(3), <b>sd_bus_default_user</b>(3),
<b>sd_bus_default_system</b>(3), <b>sd_bus_open_user</b>(3),
<b>sd_bus_open_system</b>(3),
<b>sd_bus_close</b>(3)</font></p>
<h2>NOTES
<a name="NOTES"></a>
</h2>
<table border="0" cellpadding="0" cellspacing="0" frame="void" rules="none" width="100%">
<tr align="left" valign="top">
<td width="10%"></td>
<td width="3%">
<p style="margin-top: 1em"><font color="#000000">1.</font></p> </td>
<td width="1%"></td>
<td width="35%">
<p style="margin-top: 1em"><font color="#000000">Clean-up
Variable Attribute</font></p></td>
<td width="51%">
</td></tr>
</table>
<p style="margin-left:14%;"><font color="#000000">https://gcc.gnu.org/onlinedocs/gcc/Common-Variable-Attributes.html</font></p>
<hr/>
</body>
</html>
