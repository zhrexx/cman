<!-- Creator     : groff version 1.23.0 -->
<!-- CreationDate: Sat Apr  5 19:48:18 2025 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">

<html>
<head>
<meta content="groff -Thtml, see www.gnu.org" name="generator"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="text/css" name="Content-Style"/>
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>malloc_info</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><style>
            :root {
                --primary-color: #3498db;
                --background-color: #f9f9f9;
                --text-color: #333;
                --code-bg: #f0f0f0;
                --header-color: #2c3e50;
                --link-color: #2980b9;
            }
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                line-height: 1.6;
                color: var(--text-color);
                background-color: var(--background-color);
                max-width: 900px;
                margin: 0 auto;
                padding: 2rem;
            }
            h1, h2, h3, h4 {
                color: var(--header-color);
            }
            h1 {
                border-bottom: 2px solid var(--primary-color);
                padding-bottom: 0.5rem;
            }
            pre {
                background-color: var(--code-bg);
                padding: 1rem;
                border-radius: 4px;
                overflow-x: auto;
            }
            a {
                color: var(--link-color);
                text-decoration: none;
            }
            a:hover {
                text-decoration: underline;
            }
            .man-navigation {
                background-color: #fff;
                border-bottom: 1px solid #ddd;
                padding: 0.5rem 0;
                position: sticky;
                top: 0;
                z-index: 100;
            }
            .section {
                margin-top: 2rem;
            }
            @media (prefers-color-scheme: dark) {
                :root {
                    --primary-color: #3498db;
                    --background-color: #222;
                    --text-color: #f0f0f0;
                    --code-bg: #333;
                    --header-color: #3498db;
                    --link-color: #5dade2;
                }
            }
            .back-to-index {
                display: inline-block;
                margin: 1rem 0;
                padding: 0.5rem 1rem;
                background-color: var(--primary-color);
                color: white;
                border-radius: 4px;
                text-decoration: none;
            }
            .back-to-index:hover {
                background-color: var(--link-color);
                text-decoration: none;
            }
        </style></head>
<body><div><a class="back-to-index" href="../index.html">← Back to Index</a></div>
<h1 align="center">malloc_info</h1>
<a href="#NAME">NAME</a><br/>
<a href="#LIBRARY">LIBRARY</a><br/>
<a href="#SYNOPSIS">SYNOPSIS</a><br/>
<a href="#DESCRIPTION">DESCRIPTION</a><br/>
<a href="#RETURN VALUE">RETURN VALUE</a><br/>
<a href="#ERRORS">ERRORS</a><br/>
<a href="#ATTRIBUTES">ATTRIBUTES</a><br/>
<a href="#STANDARDS">STANDARDS</a><br/>
<a href="#HISTORY">HISTORY</a><br/>
<a href="#NOTES">NOTES</a><br/>
<a href="#EXAMPLES">EXAMPLES</a><br/>
<a href="#Program source">Program source</a><br/>
<a href="#SEE ALSO">SEE ALSO</a><br/>
<hr/>
<h2>NAME
<a name="NAME"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">malloc_info
− export malloc state to a stream</p>
<h2>LIBRARY
<a name="LIBRARY"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">Standard C
library (<i>libc</i>, <i>−lc</i>)</p>
<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>#include
&lt;malloc.h&gt;</b></p>
<p style="margin-left:9%; margin-top: 1em"><b>int
malloc_info(int</b> <i>options</i><b>, FILE
*</b><i>stream</i><b>);</b></p>
<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">The
<b>malloc_info</b>() function exports an XML string that
describes the current state of the memory-allocation
implementation in the caller. The string is printed on the
file stream <i>stream</i>. The exported string includes
information about all arenas (see <b>malloc</b>(3)).</p>
<p style="margin-left:9%; margin-top: 1em">As currently
implemented, <i>options</i> must be zero.</p>
<h2>RETURN VALUE
<a name="RETURN VALUE"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">On success,
<b>malloc_info</b>() returns 0. On failure, it returns
−1, and <i>errno</i> is set to indicate the error.</p>
<h2>ERRORS
<a name="ERRORS"></a>
</h2>
<table border="0" cellpadding="0" cellspacing="0" frame="void" rules="none" width="100%">
<tr align="left" valign="top">
<td width="9%"></td>
<td width="8%">
<p style="margin-top: 1em"><b>EINVAL</b></p></td>
<td width="1%"></td>
<td width="26%">
<p style="margin-top: 1em"><i>options</i> was nonzero.</p></td>
<td width="56%">
</td></tr>
</table>
<h2>ATTRIBUTES
<a name="ATTRIBUTES"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">For an
explanation of the terms used in this section, see
<b>attributes</b>(7).</p>
<h2>STANDARDS
<a name="STANDARDS"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">GNU.</p>
<h2>HISTORY
<a name="HISTORY"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">glibc 2.10.</p>
<h2>NOTES
<a name="NOTES"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">The
memory-allocation information is provided as an XML string
(rather than a C structure) because the information may
change over time (according to changes in the underlying
implementation). The output XML string includes a version
field.</p>
<p style="margin-left:9%; margin-top: 1em">The
<b>open_memstream</b>(3) function can be used to send the
output of <b>malloc_info</b>() directly into a buffer in
memory, rather than to a file.</p>
<p style="margin-left:9%; margin-top: 1em">The
<b>malloc_info</b>() function is designed to address
deficiencies in <b>malloc_stats</b>(3) and
<b>mallinfo</b>(3).</p>
<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">The program
below takes up to four command-line arguments, of which the
first three are mandatory. The first argument specifies the
number of threads that the program should create. All of the
threads, including the main thread, allocate the number of
blocks of memory specified by the second argument. The third
argument controls the size of the blocks to be allocated.
The main thread creates blocks of this size, the second
thread created by the program allocates blocks of twice this
size, the third thread allocates blocks of three times this
size, and so on.</p>
<p style="margin-left:9%; margin-top: 1em">The program
calls <b>malloc_info</b>() twice to display the
memory-allocation state. The first call takes place before
any threads are created or memory allocated. The second call
is performed after all threads have allocated memory.</p>
<p style="margin-left:9%; margin-top: 1em">In the following
example, the command-line arguments specify the creation of
one additional thread, and both the main thread and the
additional thread allocate 10000 blocks of memory. After the
blocks of memory have been allocated, <b>malloc_info</b>()
shows the state of two allocation arenas.</p>
<p style="margin-left:14%; margin-top: 1em">$ <b>getconf
GNU_LIBC_VERSION</b> <br/>
glibc 2.13 <br/>
$ <b>./a.out 1 10000 100</b> <br/>
============ Before allocating blocks ============ <br/>
&lt;malloc version="1"&gt; <br/>
&lt;heap nr="0"&gt; <br/>
&lt;sizes&gt; <br/>
&lt;/sizes&gt; <br/>
&lt;total type="fast" count="0"
size="0"/&gt; <br/>
&lt;total type="rest" count="0"
size="0"/&gt; <br/>
&lt;system type="current"
size="135168"/&gt; <br/>
&lt;system type="max" size="135168"/&gt;
<br/>
&lt;aspace type="total"
size="135168"/&gt; <br/>
&lt;aspace type="mprotect"
size="135168"/&gt; <br/>
&lt;/heap&gt; <br/>
&lt;total type="fast" count="0"
size="0"/&gt; <br/>
&lt;total type="rest" count="0"
size="0"/&gt; <br/>
&lt;system type="current"
size="135168"/&gt; <br/>
&lt;system type="max" size="135168"/&gt;
<br/>
&lt;aspace type="total"
size="135168"/&gt; <br/>
&lt;aspace type="mprotect"
size="135168"/&gt; <br/>
&lt;/malloc&gt; <br/>
============ After allocating blocks ============ <br/>
&lt;malloc version="1"&gt; <br/>
&lt;heap nr="0"&gt; <br/>
&lt;sizes&gt; <br/>
&lt;/sizes&gt; <br/>
&lt;total type="fast" count="0"
size="0"/&gt; <br/>
&lt;total type="rest" count="0"
size="0"/&gt; <br/>
&lt;system type="current"
size="1081344"/&gt; <br/>
&lt;system type="max"
size="1081344"/&gt; <br/>
&lt;aspace type="total"
size="1081344"/&gt; <br/>
&lt;aspace type="mprotect"
size="1081344"/&gt; <br/>
&lt;/heap&gt; <br/>
&lt;heap nr="1"&gt; <br/>
&lt;sizes&gt; <br/>
&lt;/sizes&gt; <br/>
&lt;total type="fast" count="0"
size="0"/&gt; <br/>
&lt;total type="rest" count="0"
size="0"/&gt; <br/>
&lt;system type="current"
size="1032192"/&gt; <br/>
&lt;system type="max"
size="1032192"/&gt; <br/>
&lt;aspace type="total"
size="1032192"/&gt; <br/>
&lt;aspace type="mprotect"
size="1032192"/&gt; <br/>
&lt;/heap&gt; <br/>
&lt;total type="fast" count="0"
size="0"/&gt; <br/>
&lt;total type="rest" count="0"
size="0"/&gt; <br/>
&lt;system type="current"
size="2113536"/&gt; <br/>
&lt;system type="max"
size="2113536"/&gt; <br/>
&lt;aspace type="total"
size="2113536"/&gt; <br/>
&lt;aspace type="mprotect"
size="2113536"/&gt; <br/>
&lt;/malloc&gt;</p>
<h3>Program source
<a name="Program source"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em">#include
&lt;err.h&gt; <br/>
#include &lt;errno.h&gt; <br/>
#include &lt;malloc.h&gt; <br/>
#include &lt;pthread.h&gt; <br/>
#include &lt;stdlib.h&gt; <br/>
#include &lt;unistd.h&gt; <br/>
static size_t blockSize; <br/>
static size_t numThreads; <br/>
static unsigned int numBlocks; <br/>
static void * <br/>
thread_func(void *arg) <br/>
{ <br/>
int tn = (int) arg; <br/>
/* The multiplier '(2 + tn)' ensures that each thread
(including <br/>
the main thread) allocates a different amount of memory. */
<br/>
for (unsigned int j = 0; j &lt; numBlocks; j++) <br/>
if (malloc(blockSize * (2 + tn)) == NULL) <br/>
err(EXIT_FAILURE, "malloc−thread"); <br/>
sleep(100); /* Sleep until main thread terminates. */ <br/>
return NULL; <br/>
} <br/>
int <br/>
main(int argc, char *argv[]) <br/>
{ <br/>
int sleepTime; <br/>
pthread_t *thr; <br/>
if (argc &lt; 4) { <br/>
fprintf(stderr, <br/>
"%s num−threads num−blocks block−size
[sleep−time]\n", <br/>
argv[0]); <br/>
exit(EXIT_FAILURE); <br/>
} <br/>
numThreads = atoi(argv[1]); <br/>
numBlocks = atoi(argv[2]); <br/>
blockSize = atoi(argv[3]); <br/>
sleepTime = (argc &gt; 4) ? atoi(argv[4]) : 0; <br/>
thr = calloc(numThreads, sizeof(*thr)); <br/>
if (thr == NULL) <br/>
err(EXIT_FAILURE, "calloc"); <br/>
printf("============ Before allocating blocks
============\n"); <br/>
malloc_info(0, stdout); <br/>
/* Create threads that allocate different amounts of memory.
*/ <br/>
for (size_t tn = 0; tn &lt; numThreads; tn++) { <br/>
errno = pthread_create(&amp;thr[tn], NULL, thread_func, <br/>
(void *) tn); <br/>
if (errno != 0) <br/>
err(EXIT_FAILURE, "pthread_create"); <br/>
/* If we add a sleep interval after the start−up of
each <br/>
thread, the threads likely won't contend for malloc <br/>
mutexes, and therefore additional arenas won't be <br/>
allocated (see malloc(3)). */ <br/>
if (sleepTime &gt; 0) <br/>
sleep(sleepTime); <br/>
} <br/>
/* The main thread also allocates some memory. */ <br/>
for (unsigned int j = 0; j &lt; numBlocks; j++) <br/>
if (malloc(blockSize) == NULL) <br/>
err(EXIT_FAILURE, "malloc"); <br/>
sleep(2); /* Give all threads a chance to <br/>
complete allocations. */ <br/>
printf("\n============ After allocating blocks
============\n"); <br/>
malloc_info(0, stdout); <br/>
exit(EXIT_SUCCESS); <br/>
}</p>
<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>mallinfo</b>(3),
<b>malloc</b>(3), <b>malloc_stats</b>(3), <b>mallopt</b>(3),
<b>open_memstream</b>(3)</p>
<hr/>
</body>
</html>
