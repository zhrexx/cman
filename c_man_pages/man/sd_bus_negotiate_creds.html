<!-- Creator     : groff version 1.23.0 -->
<!-- CreationDate: Sat Apr  5 19:50:52 2025 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">

<html>
<head>
<meta content="groff -Thtml, see www.gnu.org" name="generator"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="text/css" name="Content-Style"/>
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>SD_BUS_NEGOTIATE_FDS</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><style>
            :root {
                --primary-color: #3498db;
                --background-color: #f9f9f9;
                --text-color: #333;
                --code-bg: #f0f0f0;
                --header-color: #2c3e50;
                --link-color: #2980b9;
            }
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                line-height: 1.6;
                color: var(--text-color);
                background-color: var(--background-color);
                max-width: 900px;
                margin: 0 auto;
                padding: 2rem;
            }
            h1, h2, h3, h4 {
                color: var(--header-color);
            }
            h1 {
                border-bottom: 2px solid var(--primary-color);
                padding-bottom: 0.5rem;
            }
            pre {
                background-color: var(--code-bg);
                padding: 1rem;
                border-radius: 4px;
                overflow-x: auto;
            }
            a {
                color: var(--link-color);
                text-decoration: none;
            }
            a:hover {
                text-decoration: underline;
            }
            .man-navigation {
                background-color: #fff;
                border-bottom: 1px solid #ddd;
                padding: 0.5rem 0;
                position: sticky;
                top: 0;
                z-index: 100;
            }
            .section {
                margin-top: 2rem;
            }
            @media (prefers-color-scheme: dark) {
                :root {
                    --primary-color: #3498db;
                    --background-color: #222;
                    --text-color: #f0f0f0;
                    --code-bg: #333;
                    --header-color: #3498db;
                    --link-color: #5dade2;
                }
            }
            .back-to-index {
                display: inline-block;
                margin: 1rem 0;
                padding: 0.5rem 1rem;
                background-color: var(--primary-color);
                color: white;
                border-radius: 4px;
                text-decoration: none;
            }
            .back-to-index:hover {
                background-color: var(--link-color);
                text-decoration: none;
            }
        </style></head>
<body><div><a class="back-to-index" href="../index.html">← Back to Index</a></div>
<h1 align="center">SD_BUS_NEGOTIATE_FDS</h1>
<a href="#NAME">NAME</a><br/>
<a href="#SYNOPSIS">SYNOPSIS</a><br/>
<a href="#DESCRIPTION">DESCRIPTION</a><br/>
<a href="#RETURN VALUE">RETURN VALUE</a><br/>
<a href="#Errors">Errors</a><br/>
<a href="#NOTES">NOTES</a><br/>
<a href="#HISTORY">HISTORY</a><br/>
<a href="#SEE ALSO">SEE ALSO</a><br/>
<hr/>
<h2>NAME
<a name="NAME"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">sd_bus_negotiate_fds,
sd_bus_negotiate_timestamp, sd_bus_negotiate_creds,
sd_bus_get_creds_mask − Control feature negotiation on
bus connections</p>
<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>#include
&lt;systemd/sd−bus.h&gt;</b></p>
<table border="0" cellpadding="0" cellspacing="0" frame="void" rules="none" width="100%">
<tr align="left" valign="top">
<td width="9%"></td>
<td width="79%">
<p style="margin-top: 1em"><b>int
sd_bus_negotiate_fds(sd_bus *</b><i>bus</i><b>,
int </b><i>b</i><b>);</b></p> </td>
<td width="12%">
</td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="79%">
<p style="margin-top: 1em"><b>int
sd_bus_negotiate_timestamp(sd_bus *</b><i>bus</i><b>,
int </b><i>b</i><b>);</b></p> </td>
<td width="12%">
</td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="79%">
<p style="margin-top: 1em"><b>int
sd_bus_negotiate_creds(sd_bus *</b><i>bus</i><b>,
int </b><i>b</i><b>,
uint64_t </b><i>mask</i><b>);</b></p> </td>
<td width="12%">
</td></tr>
<tr align="left" valign="top">
<td width="9%"></td>
<td width="79%">
<p style="margin-top: 1em"><b>int
sd_bus_get_creds_mask(sd_bus *</b><i>bus</i><b>,
uint64_t *</b><i>mask</i><b>);</b></p> </td>
<td width="12%">
</td></tr>
</table>
<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>sd_bus_negotiate_fds()</b>
controls whether file descriptor passing shall be negotiated
for the specified bus connection. It takes a bus object and
a boolean, which, when true, enables file descriptor
passing, and, when false, disables it. Note that not all
transports and servers support file descriptor passing. In
particular, networked transports generally do not support
file descriptor passing. To find out whether file descriptor
passing is available after negotiation, use
<b>sd_bus_can_send</b>(3) and pass
<b>SD_BUS_TYPE_UNIX_FD</b>. Note that file descriptor
passing is always enabled for both sending and receiving or
for neither, but never only in one direction. By default,
file descriptor passing is negotiated for all
connections.</p>
<p style="margin-left:9%; margin-top: 1em"><b>sd_bus_negotiate_timestamp()</b>
controls whether implicit sender timestamps shall be
attached automatically to all incoming messages. Takes a bus
object and a boolean, which, when true, enables
timestamping, and, when false, disables it. Use
<b>sd_bus_message_get_monotonic_usec</b>(3),
<b>sd_bus_message_get_realtime_usec</b>(3),
<b>sd_bus_message_get_seqnum</b>(3) to query the timestamps
of incoming messages. If negotiation is disabled or not
supported, these calls will fail with <b>−ENODATA</b>.
Note that currently no transports support timestamping of
messages. By default, message timestamping is not negotiated
for connections.</p>
<p style="margin-left:9%; margin-top: 1em"><b>sd_bus_negotiate_creds()</b>
controls whether and which implicit sender credentials shall
be attached automatically to all incoming messages. Takes a
bus object and a boolean indicating whether to enable or
disable the credential parts encoded in the bit mask value
argument. Note that not all transports support attaching
sender credentials to messages, or do not support all types
of sender credential parameters, or might suppress them
under certain circumstances for individual messages.
Specifically, dbus1 only supports
<b>SD_BUS_CREDS_UNIQUE_NAME</b>. The sender credentials are
suitable for authorization decisions. By default, only
<b>SD_BUS_CREDS_WELL_KNOWN_NAMES</b> and
<b>SD_BUS_CREDS_UNIQUE_NAME</b> are enabled. In fact, these
two credential fields are always sent along and cannot be
turned off.</p>
<p style="margin-left:9%; margin-top: 1em"><b>sd_bus_get_creds_mask()</b>
returns the set of sender credentials that was negotiated to
be attached to all incoming messages in <i>mask</i>. This
value is an upper boundary only. Hence, always make sure to
explicitly check which credentials are attached to a
specific message before using it.</p>
<p style="margin-left:9%; margin-top: 1em">The
<b>sd_bus_negotiate_fds()</b> function may be called only
before the connection has been started with
<b>sd_bus_start</b>(3). Both
<b>sd_bus_negotiate_timestamp()</b> and
<b>sd_bus_negotiate_creds()</b> may also be called after a
connection has been set up. Note that, when operating on a
connection that is shared between multiple components of the
same program (for example via <b>sd_bus_default</b>(3)), it
is highly recommended to only enable additional per message
metadata fields, but never disable them again, in order not
to disable functionality needed by other components.</p>
<h2>RETURN VALUE
<a name="RETURN VALUE"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">On success,
these functions return a non−negative integer. On
failure, they return a negative errno−style error
code.</p>
<h3>Errors
<a name="Errors"></a>
</h3>
<p style="margin-left:9%; margin-top: 1em">Returned errors
may indicate the following problems:</p>
<p style="margin-left:9%; margin-top: 1em"><b>−EPERM</b></p>
<p style="margin-left:14%;">The bus connection has already
been started.</p>
<p style="margin-left:9%; margin-top: 1em"><b>−EINVAL</b></p>
<p style="margin-left:14%;">An argument is invalid.</p>
<p style="margin-left:14%; margin-top: 1em">Added in
version 246.</p>
<p style="margin-left:9%; margin-top: 1em"><b>−ENOPKG</b></p>
<p style="margin-left:14%;">The bus cannot be resolved.</p>
<p style="margin-left:14%; margin-top: 1em">Added in
version 246.</p>
<p style="margin-left:9%; margin-top: 1em"><b>−ECHILD</b></p>
<p style="margin-left:14%;">The bus was created in a
different process, library or module instance.</p>
<p style="margin-left:14%; margin-top: 1em">Added in
version 246.</p>
<h2>NOTES
<a name="NOTES"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">Functions
described here are available as a shared library, which can
be compiled against and linked to with the
<b>libsystemd pkg-config</b>(1) file.</p>
<p style="margin-left:9%; margin-top: 1em">The code
described here uses <b>getenv</b>(3), which is declared to
be not multi−thread−safe. This means that the
code calling the functions described here must not call
<b>setenv</b>(3) from a parallel thread. It is recommended
to only do calls to <b>setenv()</b> from an early phase of
the program when no other threads have been started.</p>
<h2>HISTORY
<a name="HISTORY"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>sd_bus_negotiate_fds()</b>,
<b>sd_bus_negotiate_timestamp()</b>, and
<b>sd_bus_negotiate_creds()</b> were added in version
212.</p>
<p style="margin-left:9%; margin-top: 1em"><b>sd_bus_get_creds_mask()</b>
was added in version 246.</p>
<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>systemd</b>(1),
<b>sd-bus</b>(3), <b>sd_bus_start</b>(3),
<b>sd_bus_can_send</b>(3),
<b>sd_bus_message_get_monotonic_usec</b>(3),
<b>sd_bus_message_get_realtime_usec</b>(3),
<b>sd_bus_message_get_seqnum</b>(3),
<b>sd_bus_message_get_creds</b>(3)</p>
<hr/>
</body>
</html>
