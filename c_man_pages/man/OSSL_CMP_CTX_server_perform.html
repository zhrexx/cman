<!-- Creator     : groff version 1.23.0 -->
<!-- CreationDate: Sat Apr  5 19:48:58 2025 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">

<html>
<head>
<meta content="groff -Thtml, see www.gnu.org" name="generator"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="text/css" name="Content-Style"/>
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>OSSL_CMP_SRV_CTX_NEW</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><style>
            :root {
                --primary-color: #3498db;
                --background-color: #f9f9f9;
                --text-color: #333;
                --code-bg: #f0f0f0;
                --header-color: #2c3e50;
                --link-color: #2980b9;
            }
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                line-height: 1.6;
                color: var(--text-color);
                background-color: var(--background-color);
                max-width: 900px;
                margin: 0 auto;
                padding: 2rem;
            }
            h1, h2, h3, h4 {
                color: var(--header-color);
            }
            h1 {
                border-bottom: 2px solid var(--primary-color);
                padding-bottom: 0.5rem;
            }
            pre {
                background-color: var(--code-bg);
                padding: 1rem;
                border-radius: 4px;
                overflow-x: auto;
            }
            a {
                color: var(--link-color);
                text-decoration: none;
            }
            a:hover {
                text-decoration: underline;
            }
            .man-navigation {
                background-color: #fff;
                border-bottom: 1px solid #ddd;
                padding: 0.5rem 0;
                position: sticky;
                top: 0;
                z-index: 100;
            }
            .section {
                margin-top: 2rem;
            }
            @media (prefers-color-scheme: dark) {
                :root {
                    --primary-color: #3498db;
                    --background-color: #222;
                    --text-color: #f0f0f0;
                    --code-bg: #333;
                    --header-color: #3498db;
                    --link-color: #5dade2;
                }
            }
            .back-to-index {
                display: inline-block;
                margin: 1rem 0;
                padding: 0.5rem 1rem;
                background-color: var(--primary-color);
                color: white;
                border-radius: 4px;
                text-decoration: none;
            }
            .back-to-index:hover {
                background-color: var(--link-color);
                text-decoration: none;
            }
        </style></head>
<body><div><a class="back-to-index" href="../index.html">← Back to Index</a></div>
<h1 align="center">OSSL_CMP_SRV_CTX_NEW</h1>
<a href="#NAME">NAME</a><br/>
<a href="#SYNOPSIS">SYNOPSIS</a><br/>
<a href="#DESCRIPTION">DESCRIPTION</a><br/>
<a href="#NOTES">NOTES</a><br/>
<a href="#RETURN VALUES">RETURN VALUES</a><br/>
<a href="#HISTORY">HISTORY</a><br/>
<a href="#COPYRIGHT">COPYRIGHT</a><br/>
<hr/>
<h2>NAME
<a name="NAME"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">OSSL_CMP_SRV_process_request,
OSSL_CMP_CTX_server_perform, OSSL_CMP_SRV_CTX_new,
OSSL_CMP_SRV_CTX_free, OSSL_CMP_SRV_cert_request_cb_t,
OSSL_CMP_SRV_rr_cb_t, OSSL_CMP_SRV_certConf_cb_t,
OSSL_CMP_SRV_genm_cb_t, OSSL_CMP_SRV_error_cb_t,
OSSL_CMP_SRV_pollReq_cb_t, OSSL_CMP_SRV_CTX_init,
OSSL_CMP_SRV_CTX_get0_cmp_ctx,
OSSL_CMP_SRV_CTX_get0_custom_ctx,
OSSL_CMP_SRV_CTX_set_send_unprotected_errors,
OSSL_CMP_SRV_CTX_set_accept_unprotected,
OSSL_CMP_SRV_CTX_set_accept_raverified,
OSSL_CMP_SRV_CTX_set_grant_implicit_confirm − generic
functions to set up and control a CMP server</p>
<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">#include
&lt;openssl/cmp.h&gt; <br/>
OSSL_CMP_MSG *OSSL_CMP_SRV_process_request(OSSL_CMP_SRV_CTX
*srv_ctx, <br/>
const OSSL_CMP_MSG *req); <br/>
OSSL_CMP_MSG *OSSL_CMP_CTX_server_perform(OSSL_CMP_CTX
*client_ctx, <br/>
const OSSL_CMP_MSG *req); <br/>
OSSL_CMP_SRV_CTX *OSSL_CMP_SRV_CTX_new(OSSL_LIB_CTX *libctx,
const char *propq); <br/>
void OSSL_CMP_SRV_CTX_free(OSSL_CMP_SRV_CTX *srv_ctx); <br/>
typedef OSSL_CMP_PKISI *(*OSSL_CMP_SRV_cert_request_cb_t)(
<br/>
OSSL_CMP_SRV_CTX *srv_ctx, <br/>
const OSSL_CMP_MSG *req, <br/>
int certReqId, <br/>
const OSSL_CRMF_MSG *crm, <br/>
const X509_REQ *p10cr, <br/>
X509 **certOut, <br/>
STACK_OF(X509) **chainOut, <br/>
STACK_OF(X509) **caPubs); <br/>
typedef OSSL_CMP_PKISI
*(*OSSL_CMP_SRV_rr_cb_t)(OSSL_CMP_SRV_CTX *srv_ctx, <br/>
const OSSL_CMP_MSG *req, <br/>
const X509_NAME *issuer, <br/>
const ASN1_INTEGER *serial); <br/>
typedef int (*OSSL_CMP_SRV_genm_cb_t)(OSSL_CMP_SRV_CTX
*srv_ctx, <br/>
const OSSL_CMP_MSG *req, <br/>
STACK_OF(OSSL_CMP_ITAV) *in, <br/>
STACK_OF(OSSL_CMP_ITAV) **out); <br/>
typedef void (*OSSL_CMP_SRV_error_cb_t)(OSSL_CMP_SRV_CTX
*srv_ctx, <br/>
const OSSL_CMP_MSG *req, <br/>
const OSSL_CMP_PKISI *statusInfo, <br/>
const ASN1_INTEGER *errorCode, <br/>
const OSSL_CMP_PKIFREETEXT *errorDetails); <br/>
typedef int (*OSSL_CMP_SRV_certConf_cb_t)(OSSL_CMP_SRV_CTX
*srv_ctx, <br/>
const OSSL_CMP_MSG *req, <br/>
int certReqId, <br/>
const ASN1_OCTET_STRING *certHash, <br/>
const OSSL_CMP_PKISI *si); <br/>
typedef int (*OSSL_CMP_SRV_pollReq_cb_t)(OSSL_CMP_SRV_CTX
*srv_ctx, <br/>
const OSSL_CMP_MSG *req, <br/>
int certReqId, <br/>
OSSL_CMP_MSG **certReq, <br/>
int64_t *check_after); <br/>
int OSSL_CMP_SRV_CTX_init(OSSL_CMP_SRV_CTX *srv_ctx, void
*custom_ctx, <br/>
OSSL_CMP_SRV_cert_request_cb_t process_cert_request, <br/>
OSSL_CMP_SRV_rr_cb_t process_rr, <br/>
OSSL_CMP_SRV_genm_cb_t process_genm, <br/>
OSSL_CMP_SRV_error_cb_t process_error, <br/>
OSSL_CMP_SRV_certConf_cb_t process_certConf, <br/>
OSSL_CMP_SRV_pollReq_cb_t process_pollReq); <br/>
OSSL_CMP_CTX *OSSL_CMP_SRV_CTX_get0_cmp_ctx(const
OSSL_CMP_SRV_CTX *srv_ctx); <br/>
void *OSSL_CMP_SRV_CTX_get0_custom_ctx(const
OSSL_CMP_SRV_CTX *srv_ctx); <br/>
int
OSSL_CMP_SRV_CTX_set_send_unprotected_errors(OSSL_CMP_SRV_CTX
*srv_ctx, <br/>
int val); <br/>
int OSSL_CMP_SRV_CTX_set_accept_unprotected(OSSL_CMP_SRV_CTX
*srv_ctx, int val); <br/>
int OSSL_CMP_SRV_CTX_set_accept_raverified(OSSL_CMP_SRV_CTX
*srv_ctx, int val); <br/>
int
OSSL_CMP_SRV_CTX_set_grant_implicit_confirm(OSSL_CMP_SRV_CTX
*srv_ctx, <br/>
int val);</p>
<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>OSSL_CMP_SRV_process_request()</b>
implements the generic aspects of a CMP server. Its
arguments are the <b>OSSL_CMP_SRV_CTX</b> <i>srv_ctx</i> and
the CMP request message <i>req</i>. It does the typical
generic checks on <i>req</i>, calls the respective callback
function (if present) for more specific processing, and then
assembles a result message, which may be a CMP error
message. If after return of the function the expression
<i>OSSL_CMP_CTX_get_status(OSSL_CMP_SRV_CTX_get0_cmp_ctx(srv_ctx))</i>
yields −1 then the function has closed the current
transaction, which may be due to normal successful end of
the transaction or due to an error.</p>
<p style="margin-left:9%; margin-top: 1em"><b>OSSL_CMP_CTX_server_perform()</b>
is an interface to <b>OSSL_CMP_SRV_process_request()</b>
that can be used by a CMP client in the same way as
<b>OSSL_CMP_MSG_http_perform</b>(3). The
<b>OSSL_CMP_SRV_CTX</b> must be set as
<i>transfer_cb_arg</i> of <i>client_ctx</i>.</p>
<p style="margin-left:9%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_new()</b>
creates and initializes an <b>OSSL_CMP_SRV_CTX</b> structure
associated with the library context <i>libctx</i> and
property query string <i>propq</i>, both of which may be
NULL to select the defaults.</p>
<p style="margin-left:9%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_free()</b>
deletes the given <i>srv_ctx</i>. If the argument is NULL,
nothing is done.</p>
<p style="margin-left:9%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_init()</b>
sets in the given <i>srv_ctx</i> a custom server context
pointer as well as callback functions performing the
specific processing of CMP certificate requests, revocation
requests, certificate confirmation requests, general
messages, error messages, and poll requests. All arguments
except <i>srv_ctx</i> may be NULL. If a callback for some
message type is not given this means that the respective
type of CMP message is not supported by the server.</p>
<p style="margin-left:9%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_get0_cmp_ctx()</b>
returns the <b>OSSL_CMP_CTX</b> from the <i>srv_ctx</i>.</p>
<p style="margin-left:9%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_get0_custom_ctx()</b>
returns the custom server context from <i>srv_ctx</i> that
has been set using <b>OSSL_CMP_SRV_CTX_init()</b>.</p>
<p style="margin-left:9%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_set_send_unprotected_errors()</b>
enables sending error messages and other forms of negative
responses unprotected.</p>
<p style="margin-left:9%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_set_accept_unprotected()</b>
enables acceptance of requests without protection of with
invalid protection.</p>
<p style="margin-left:9%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_set_accept_raverified()</b>
enables acceptance of ir/cr/kur messages with POPO
'RAVerified'.</p>
<p style="margin-left:9%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_set_grant_implicit_confirm()</b>
enables granting implicit confirmation of newly enrolled
certificates if requested.</p>
<h2>NOTES
<a name="NOTES"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">CMP is defined
in RFC 4210 (and CRMF in RFC 4211).</p>
<p style="margin-left:9%; margin-top: 1em">So far the CMP
server implementation is limited to one request per CMP
message (and consequently to at most one response component
per CMP message).</p>
<h2>RETURN VALUES
<a name="RETURN VALUES"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_new()</b>
returns a <b>OSSL_CMP_SRV_CTX</b> structure on success, NULL
on error.</p>
<p style="margin-left:9%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_free()</b>
does not return a value.</p>
<p style="margin-left:9%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_get0_cmp_ctx()</b>
returns a <b>OSSL_CMP_CTX</b> structure on success, NULL on
error.</p>
<p style="margin-left:9%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_get0_custom_ctx()</b>
returns the custom server context that has been set using
<b>OSSL_CMP_SRV_CTX_init()</b>.</p>
<p style="margin-left:9%; margin-top: 1em">All other
functions return 1 on success, 0 on error.</p>
<h2>HISTORY
<a name="HISTORY"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">The OpenSSL CMP
support was added in OpenSSL 3.0.</p>
<h2>COPYRIGHT
<a name="COPYRIGHT"></a>
</h2>
<p style="margin-left:9%; margin-top: 1em">Copyright
2007−2024 The OpenSSL Project Authors. All Rights
Reserved.</p>
<p style="margin-left:9%; margin-top: 1em">Licensed under
the Apache License 2.0 (the "License"). You may
not use this file except in compliance with the License. You
can obtain a copy in the file LICENSE in the source
distribution or at
&lt;https://www.openssl.org/source/license.html&gt;.</p>
<hr/>
</body>
</html>
